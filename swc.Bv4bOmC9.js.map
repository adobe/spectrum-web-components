{"version":3,"file":"swc.DrNXZKLt.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js"],"sourcesContent":["\"use strict\";function o(r,e,t){return typeof r===e?()=>r:typeof r==\"function\"?r:t}export class FocusGroupController{constructor(e,{hostDelegatesFocus:t,direction:n,elementEnterAction:s,elements:i,focusInIndex:h,isFocusableElement:c,listenerScope:l}={elements:()=>[]}){this._currentIndex=-1;this.prevIndex=-1;this._direction=()=>\"both\";this.directionLength=5;this.hostDelegatesFocus=!1;this.elementEnterAction=e=>{};this._focused=!1;this._focusInIndex=e=>0;this.isFocusableElement=e=>!0;this._listenerScope=()=>this.host;this.offset=0;this.recentlyConnected=!1;this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;const t=e.composedPath();let n=-1;t.find(s=>(n=this.elements.indexOf(s),n!==-1)),this.prevIndex=this.currentIndex,this.currentIndex=n>-1?n:this.currentIndex,this.isRelatedTargetOrContainAnElement(e)&&this.hostContainsFocus()};this.handleClick=()=>{var n;const e=this.elements;if(!e.length)return;let t=e[this.currentIndex];this.currentIndex<0||((!t||!this.isFocusableElement(t))&&(this.setCurrentIndexCircularly(1),t=e[this.currentIndex]),t&&this.isFocusableElement(t)&&((n=e[this.prevIndex])==null||n.setAttribute(\"tabindex\",\"-1\"),t.setAttribute(\"tabindex\",\"0\")))};this.handleFocusout=e=>{this.isRelatedTargetOrContainAnElement(e)&&this.hostNoLongerContainsFocus()};this.handleKeydown=e=>{if(!this.acceptsEventKey(e.key)||e.defaultPrevented)return;let t=0;switch(this.prevIndex=this.currentIndex,e.key){case\"ArrowRight\":t+=1;break;case\"ArrowDown\":t+=this.direction===\"grid\"?this.directionLength:1;break;case\"ArrowLeft\":t-=1;break;case\"ArrowUp\":t-=this.direction===\"grid\"?this.directionLength:1;break;case\"End\":this.currentIndex=0,t-=1;break;case\"Home\":this.currentIndex=this.elements.length-1,t+=1;break}e.preventDefault(),this.direction===\"grid\"&&this.currentIndex+t<0?this.currentIndex=0:this.direction===\"grid\"&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()};this.mutationObserver=new MutationObserver(()=>{this.handleItemMutation()}),this.hostDelegatesFocus=t||!1,this.host=e,this.host.addController(this),this._elements=i,this.isFocusableElement=c||this.isFocusableElement,this._direction=o(n,\"string\",this._direction),this.elementEnterAction=s||this.elementEnterAction,this._focusInIndex=o(h,\"number\",this._focusInIndex),this._listenerScope=o(l,\"object\",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(this._currentIndex==-1||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,n=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(n),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}reset(){var n;const e=this.elements;if(!e.length)return;this.setCurrentIndexCircularly(this.focusInIndex-this.currentIndex);let t=e[this.currentIndex];this.currentIndex<0||((!t||!this.isFocusableElement(t))&&(this.setCurrentIndexCircularly(1),t=e[this.currentIndex]),t&&this.isFocusableElement(t)&&((n=e[this.prevIndex])==null||n.setAttribute(\"tabindex\",\"-1\"),t.setAttribute(\"tabindex\",\"0\")))}focusOnItem(e,t){var i;const n=this.elements||[],s=!e||!this.isFocusableElement(e)?-1:n.indexOf(e);s>-1&&(this.currentIndex=s,(i=n[this.prevIndex])==null||i.setAttribute(\"tabindex\",\"-1\")),this.focus(t)}focus(e){var s;const t=this.elements;if(!t.length)return;let n=t[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=t[this.currentIndex]),n&&this.isFocusableElement(n)&&((!this.hostDelegatesFocus||t[this.prevIndex]!==n)&&((s=t[this.prevIndex])==null||s.setAttribute(\"tabindex\",\"-1\")),n.tabIndex=0,n.focus(e),this.hostDelegatesFocus&&!this.focused&&this.hostContainsFocus())}clearElementCache(e=0){this.mutationObserver.disconnect(),delete this.cachedElements,this.offset=e,requestAnimationFrame(()=>{this.elements.forEach(t=>{this.mutationObserver.observe(t,{attributes:!0})})})}setCurrentIndexCircularly(e){const{length:t}=this.elements;let n=t;this.prevIndex=this.currentIndex;let s=(t+this.currentIndex+e)%t;for(;n&&this.elements[s]&&!this.isFocusableElement(this.elements[s]);)s=(t+s+e)%t,n-=1;this.currentIndex=s}hostContainsFocus(){this.host.addEventListener(\"focusout\",this.handleFocusout),this.host.addEventListener(\"keydown\",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.focused=!1}isRelatedTargetOrContainAnElement(e){const t=e.relatedTarget,n=this.elements.includes(t),s=this.elements.some(i=>i.contains(t));return!(n||s)}acceptsEventKey(e){if(e===\"End\"||e===\"Home\")return!0;switch(this.direction){case\"horizontal\":return e===\"ArrowLeft\"||e===\"ArrowRight\";case\"vertical\":return e===\"ArrowUp\"||e===\"ArrowDown\";case\"both\":case\"grid\":return e.startsWith(\"Arrow\")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.addEventListener(\"click\",this.handleClick)}removeEventListeners(){this.host.removeEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.host.removeEventListener(\"click\",this.handleClick)}hostConnected(){this.recentlyConnected=!0,this.addEventListeners()}hostDisconnected(){this.mutationObserver.disconnect(),this.removeEventListeners()}hostUpdated(){this.recentlyConnected&&(this.recentlyConnected=!1,this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})}))}}\n//# sourceMappingURL=FocusGroup.js.map\n"],"names":["o","r","e","t","FocusGroupController","constructor","hostDelegatesFocus","direction","n","elementEnterAction","s","elements","i","focusInIndex","h","isFocusableElement","c","listenerScope","l","this","_currentIndex","prevIndex","_direction","directionLength","_focused","_focusInIndex","_listenerScope","host","offset","recentlyConnected","handleFocusin","isEventWithinListenerScope","composedPath","find","indexOf","currentIndex","isRelatedTargetOrContainAnElement","hostContainsFocus","handleClick","length","setCurrentIndexCircularly","setAttribute","handleFocusout","hostNoLongerContainsFocus","handleKeydown","acceptsEventKey","key","defaultPrevented","preventDefault","focus","mutationObserver","MutationObserver","handleItemMutation","addController","_elements","cachedElements","focused","focusInElement","includes","clearElementCache","update","unmanage","manage","reset","focusOnItem","tabIndex","disconnect","requestAnimationFrame","forEach","observe","attributes","addEventListener","removeEventListener","relatedTarget","some","contains","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","hostUpdated"],"mappings":"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"}