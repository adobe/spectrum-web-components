function e(e,t,s){return typeof e===t?()=>e:"function"==typeof e?e:s}class t{constructor(t,{hostDelegatesFocus:s,direction:n,elementEnterAction:i,elements:r,focusInIndex:h,isFocusableElement:o,listenerScope:c,stopKeyEventPropagation:u}={elements:()=>[]}){this._currentIndex=-1,this.prevIndex=-1,this._direction=()=>"both",this.directionLength=5,this.hostDelegatesFocus=!1,this.elementEnterAction=e=>{},this._focused=!1,this._focusInIndex=e=>0,this.isFocusableElement=e=>!0,this._listenerScope=()=>this.host,this.offset=0,this.recentlyConnected=!1,this.stopKeyEventPropagation=!1,this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;const t=e.composedPath();let s=-1;t.find(e=>(s=this.elements.indexOf(e),-1!==s)),this.prevIndex=this.currentIndex,this.currentIndex=s>-1?s:this.currentIndex,this.isRelatedTargetOrContainAnElement(e)&&this.hostContainsFocus()},this.handleClick=()=>{var e;const t=this.elements;if(!t.length)return;let s=t[this.currentIndex];this.currentIndex<0||((!s||!this.isFocusableElement(s))&&(this.setCurrentIndexCircularly(1),s=t[this.currentIndex]),s&&this.isFocusableElement(s)&&(null==(e=t[this.prevIndex])||e.setAttribute("tabindex","-1"),s.setAttribute("tabindex","0")))},this.handleFocusout=e=>{this.isRelatedTargetOrContainAnElement(e)&&this.hostNoLongerContainsFocus()},this.handleKeydown=e=>{if(!this.acceptsEventKey(e.key)||e.defaultPrevented)return;let t=0;switch(this.prevIndex=this.currentIndex,e.key){case"ArrowRight":t+=1;break;case"ArrowDown":t+="grid"===this.direction?this.directionLength:1;break;case"ArrowLeft":t-=1;break;case"ArrowUp":t-="grid"===this.direction?this.directionLength:1;break;case"End":this.currentIndex=0,t-=1;break;case"Home":this.currentIndex=this.elements.length-1,t+=1}e.preventDefault(),this.stopKeyEventPropagation&&e.stopPropagation(),"grid"===this.direction&&this.currentIndex+t<0?this.currentIndex=0:"grid"===this.direction&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()},this.mutationObserver=new MutationObserver(()=>{this.handleItemMutation()}),this.hostDelegatesFocus=s||!1,this.stopKeyEventPropagation=u||!1,this.host=t,this.host.addController(this),this._elements=r,this.isFocusableElement=o||this.isFocusableElement,this._direction=e(n,"string",this._direction),this.elementEnterAction=i||this.elementEnterAction,this._focusInIndex=e(h,"number",this._focusInIndex),this._listenerScope=e(c,"object",this._listenerScope)}get currentIndex(){return-1===this._currentIndex&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host||e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(-1==this._currentIndex||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,s=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(s),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}reset(){var e;const t=this.elements;if(!t.length)return;this.setCurrentIndexCircularly(this.focusInIndex-this.currentIndex);let s=t[this.currentIndex];this.currentIndex<0||((!s||!this.isFocusableElement(s))&&(this.setCurrentIndexCircularly(1),s=t[this.currentIndex]),s&&this.isFocusableElement(s)&&(null==(e=t[this.prevIndex])||e.setAttribute("tabindex","-1"),s.setAttribute("tabindex","0")))}focusOnItem(e,t){var s;const n=this.elements||[],i=e&&this.isFocusableElement(e)?n.indexOf(e):-1;i>-1&&(this.currentIndex=i,null==(s=n[this.prevIndex])||s.setAttribute("tabindex","-1")),this.focus(t)}focus(e){var t;const s=this.elements;if(!s.length)return;let n=s[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=s[this.currentIndex]),n&&this.isFocusableElement(n)&&((!this.hostDelegatesFocus||s[this.prevIndex]!==n)&&(null==(t=s[this.prevIndex])||t.setAttribute("tabindex","-1")),n.tabIndex=0,n.focus(e),this.hostDelegatesFocus&&!this.focused&&this.hostContainsFocus())}clearElementCache(e=0){this.mutationObserver.disconnect(),delete this.cachedElements,this.offset=e,requestAnimationFrame(()=>{this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})})})}setCurrentIndexCircularly(e){const{length:t}=this.elements;let s=t;this.prevIndex=this.currentIndex;let n=(t+this.currentIndex+e)%t;for(;s&&this.elements[n]&&!this.isFocusableElement(this.elements[n]);)n=(t+n+e)%t,s-=1;this.currentIndex=n}hostContainsFocus(){this.host.addEventListener("focusout",this.handleFocusout),this.host.addEventListener("keydown",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener("focusin",this.handleFocusin),this.host.removeEventListener("focusout",this.handleFocusout),this.host.removeEventListener("keydown",this.handleKeydown),this.focused=!1}isRelatedTargetOrContainAnElement(e){const t=e.relatedTarget,s=this.elements.includes(t),n=this.elements.some(e=>e.contains(t));return!(s||n)}acceptsEventKey(e){if("End"===e||"Home"===e)return!0;switch(this.direction){case"horizontal":return"ArrowLeft"===e||"ArrowRight"===e;case"vertical":return"ArrowUp"===e||"ArrowDown"===e;case"both":case"grid":return e.startsWith("Arrow")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener("focusin",this.handleFocusin),this.host.addEventListener("click",this.handleClick)}removeEventListeners(){this.host.removeEventListener("focusin",this.handleFocusin),this.host.removeEventListener("focusout",this.handleFocusout),this.host.removeEventListener("keydown",this.handleKeydown),this.host.removeEventListener("click",this.handleClick)}hostConnected(){this.recentlyConnected=!0,this.addEventListeners()}hostDisconnected(){this.mutationObserver.disconnect(),this.removeEventListeners()}hostUpdated(){this.recentlyConnected&&(this.recentlyConnected=!1,this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})}))}}export{t as F};
//# sourceMappingURL=swc.CDZiVmYk.js.map
