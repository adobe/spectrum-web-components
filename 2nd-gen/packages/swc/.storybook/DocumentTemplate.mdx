import {
    Meta,
    Title,
    Primary,
    Controls,
    Stories,
    ArgTypes,
    Description,
    Subtitle,
    useOf,
} from '@storybook/addon-docs/blocks';
import { GettingStarted, SpectrumStories, OverviewStory } from './blocks';

export const checkIsSingleStory = () => {
    const resolvedOf = useOf('meta', ['meta']);
    const { stories } = resolvedOf.csfFile;
    const visibleStories = Object.values(stories).filter(
        (story) =>
            story.tags?.includes('autodocs') || story.tags?.includes('dev')
    );
    return visibleStories.length === 1;
};

export const SingleStoryDescription = () => {
    const isSingleStory = checkIsSingleStory();

    return (isSingleStory ? <Description of="story" /> : null)

}

export const AdvancedExamplesStories = () => {
    const isSingleStory = checkIsSingleStory();

    return (isSingleStory ? null : <Stories includePrimary={false} />)

}

export const ConditionalSection = ({ tag, title, hideTitle = false }) => {
    const resolvedOf = useOf('meta', ['meta']);
    const hasStories = Object.values(resolvedOf.csfFile.stories).some(
        (story) => story.tags?.includes(tag)
    );

    if (!hasStories) {
        return null;
    }

    return (
        <>
            {title && <h2>{title}</h2>}
            <SpectrumStories tag={tag} hideTitle={hideTitle} />
        </>
    );

};

<Meta isTemplate />

<Title />
<Subtitle />
<Description />
<SingleStoryDescription />
<OverviewStory />
<GettingStarted />

<ConditionalSection tag="anatomy" title="Anatomy" hideTitle={true} />
<ConditionalSection tag="options" title="Options" />
<ConditionalSection tag="states" title="States" />
<ConditionalSection tag="behaviors" title="Behaviors" />
<ConditionalSection tag="a11y" title="Accessibility" hideTitle={true} />

## API

<Primary />
<Controls />
<AdvancedExamplesStories />

## Feedback

Have feedback or questions? [Open an issue](https://github.com/adobe/spectrum-web-components/issues/new/choose).
