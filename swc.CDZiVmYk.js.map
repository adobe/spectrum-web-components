{"version":3,"file":"swc.BgRubb97.js","sources":["../../../tools/reactive-controllers/src/FocusGroup.js"],"sourcesContent":["\"use strict\";function o(r,e,t){return typeof r===e?()=>r:typeof r==\"function\"?r:t}export class FocusGroupController{constructor(e,{hostDelegatesFocus:t,direction:n,elementEnterAction:s,elements:i,focusInIndex:h,isFocusableElement:c,listenerScope:l,stopKeyEventPropagation:u}={elements:()=>[]}){this._currentIndex=-1;this.prevIndex=-1;this._direction=()=>\"both\";this.directionLength=5;this.hostDelegatesFocus=!1;this.elementEnterAction=e=>{};this._focused=!1;this._focusInIndex=e=>0;this.isFocusableElement=e=>!0;this._listenerScope=()=>this.host;this.offset=0;this.recentlyConnected=!1;this.stopKeyEventPropagation=!1;this.handleFocusin=e=>{if(!this.isEventWithinListenerScope(e))return;const t=e.composedPath();let n=-1;t.find(s=>(n=this.elements.indexOf(s),n!==-1)),this.prevIndex=this.currentIndex,this.currentIndex=n>-1?n:this.currentIndex,this.isRelatedTargetOrContainAnElement(e)&&this.hostContainsFocus()};this.handleClick=()=>{var n;const e=this.elements;if(!e.length)return;let t=e[this.currentIndex];this.currentIndex<0||((!t||!this.isFocusableElement(t))&&(this.setCurrentIndexCircularly(1),t=e[this.currentIndex]),t&&this.isFocusableElement(t)&&((n=e[this.prevIndex])==null||n.setAttribute(\"tabindex\",\"-1\"),t.setAttribute(\"tabindex\",\"0\")))};this.handleFocusout=e=>{this.isRelatedTargetOrContainAnElement(e)&&this.hostNoLongerContainsFocus()};this.handleKeydown=e=>{if(!this.acceptsEventKey(e.key)||e.defaultPrevented)return;let t=0;switch(this.prevIndex=this.currentIndex,e.key){case\"ArrowRight\":t+=1;break;case\"ArrowDown\":t+=this.direction===\"grid\"?this.directionLength:1;break;case\"ArrowLeft\":t-=1;break;case\"ArrowUp\":t-=this.direction===\"grid\"?this.directionLength:1;break;case\"End\":this.currentIndex=0,t-=1;break;case\"Home\":this.currentIndex=this.elements.length-1,t+=1;break}e.preventDefault(),this.stopKeyEventPropagation&&e.stopPropagation(),this.direction===\"grid\"&&this.currentIndex+t<0?this.currentIndex=0:this.direction===\"grid\"&&this.currentIndex+t>this.elements.length-1?this.currentIndex=this.elements.length-1:this.setCurrentIndexCircularly(t),this.elementEnterAction(this.elements[this.currentIndex]),this.focus()};this.mutationObserver=new MutationObserver(()=>{this.handleItemMutation()}),this.hostDelegatesFocus=t||!1,this.stopKeyEventPropagation=u||!1,this.host=e,this.host.addController(this),this._elements=i,this.isFocusableElement=c||this.isFocusableElement,this._direction=o(n,\"string\",this._direction),this.elementEnterAction=s||this.elementEnterAction,this._focusInIndex=o(h,\"number\",this._focusInIndex),this._listenerScope=o(l,\"object\",this._listenerScope)}get currentIndex(){return this._currentIndex===-1&&(this._currentIndex=this.focusInIndex),this._currentIndex-this.offset}set currentIndex(e){this._currentIndex=e+this.offset}get direction(){return this._direction()}get elements(){return this.cachedElements||(this.cachedElements=this._elements()),this.cachedElements}set focused(e){e!==this.focused&&(this._focused=e)}get focused(){return this._focused}get focusInElement(){return this.elements[this.focusInIndex]}get focusInIndex(){return this._focusInIndex(this.elements)}isEventWithinListenerScope(e){return this._listenerScope()===this.host?!0:e.composedPath().includes(this._listenerScope())}handleItemMutation(){if(this._currentIndex==-1||this.elements.length<=this._elements().length)return;const e=this.elements[this.currentIndex];if(this.clearElementCache(),this.elements.includes(e))return;const t=this.currentIndex!==this.elements.length,n=t?1:-1;t&&this.setCurrentIndexCircularly(-1),this.setCurrentIndexCircularly(n),this.focus()}update({elements:e}={elements:()=>[]}){this.unmanage(),this._elements=e,this.clearElementCache(),this.manage()}reset(){var n;const e=this.elements;if(!e.length)return;this.setCurrentIndexCircularly(this.focusInIndex-this.currentIndex);let t=e[this.currentIndex];this.currentIndex<0||((!t||!this.isFocusableElement(t))&&(this.setCurrentIndexCircularly(1),t=e[this.currentIndex]),t&&this.isFocusableElement(t)&&((n=e[this.prevIndex])==null||n.setAttribute(\"tabindex\",\"-1\"),t.setAttribute(\"tabindex\",\"0\")))}focusOnItem(e,t){var i;const n=this.elements||[],s=!e||!this.isFocusableElement(e)?-1:n.indexOf(e);s>-1&&(this.currentIndex=s,(i=n[this.prevIndex])==null||i.setAttribute(\"tabindex\",\"-1\")),this.focus(t)}focus(e){var s;const t=this.elements;if(!t.length)return;let n=t[this.currentIndex];(!n||!this.isFocusableElement(n))&&(this.setCurrentIndexCircularly(1),n=t[this.currentIndex]),n&&this.isFocusableElement(n)&&((!this.hostDelegatesFocus||t[this.prevIndex]!==n)&&((s=t[this.prevIndex])==null||s.setAttribute(\"tabindex\",\"-1\")),n.tabIndex=0,n.focus(e),this.hostDelegatesFocus&&!this.focused&&this.hostContainsFocus())}clearElementCache(e=0){this.mutationObserver.disconnect(),delete this.cachedElements,this.offset=e,requestAnimationFrame(()=>{this.elements.forEach(t=>{this.mutationObserver.observe(t,{attributes:!0})})})}setCurrentIndexCircularly(e){const{length:t}=this.elements;let n=t;this.prevIndex=this.currentIndex;let s=(t+this.currentIndex+e)%t;for(;n&&this.elements[s]&&!this.isFocusableElement(this.elements[s]);)s=(t+s+e)%t,n-=1;this.currentIndex=s}hostContainsFocus(){this.host.addEventListener(\"focusout\",this.handleFocusout),this.host.addEventListener(\"keydown\",this.handleKeydown),this.focused=!0}hostNoLongerContainsFocus(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.focused=!1}isRelatedTargetOrContainAnElement(e){const t=e.relatedTarget,n=this.elements.includes(t),s=this.elements.some(i=>i.contains(t));return!(n||s)}acceptsEventKey(e){if(e===\"End\"||e===\"Home\")return!0;switch(this.direction){case\"horizontal\":return e===\"ArrowLeft\"||e===\"ArrowRight\";case\"vertical\":return e===\"ArrowUp\"||e===\"ArrowDown\";case\"both\":case\"grid\":return e.startsWith(\"Arrow\")}}manage(){this.addEventListeners()}unmanage(){this.removeEventListeners()}addEventListeners(){this.host.addEventListener(\"focusin\",this.handleFocusin),this.host.addEventListener(\"click\",this.handleClick)}removeEventListeners(){this.host.removeEventListener(\"focusin\",this.handleFocusin),this.host.removeEventListener(\"focusout\",this.handleFocusout),this.host.removeEventListener(\"keydown\",this.handleKeydown),this.host.removeEventListener(\"click\",this.handleClick)}hostConnected(){this.recentlyConnected=!0,this.addEventListeners()}hostDisconnected(){this.mutationObserver.disconnect(),this.removeEventListeners()}hostUpdated(){this.recentlyConnected&&(this.recentlyConnected=!1,this.elements.forEach(e=>{this.mutationObserver.observe(e,{attributes:!0})}))}}\n//# sourceMappingURL=FocusGroup.js.map\n"],"names":["o","r","e","t","FocusGroupController","constructor","hostDelegatesFocus","direction","n","elementEnterAction","s","elements","i","focusInIndex","h","isFocusableElement","c","listenerScope","l","stopKeyEventPropagation","u","this","_currentIndex","prevIndex","_direction","directionLength","_focused","_focusInIndex","_listenerScope","host","offset","recentlyConnected","handleFocusin","isEventWithinListenerScope","composedPath","find","indexOf","currentIndex","isRelatedTargetOrContainAnElement","hostContainsFocus","handleClick","length","setCurrentIndexCircularly","setAttribute","handleFocusout","hostNoLongerContainsFocus","handleKeydown","acceptsEventKey","key","defaultPrevented","preventDefault","stopPropagation","focus","mutationObserver","MutationObserver","handleItemMutation","addController","_elements","cachedElements","focused","focusInElement","includes","clearElementCache","update","unmanage","manage","reset","focusOnItem","tabIndex","disconnect","requestAnimationFrame","forEach","observe","attributes","addEventListener","removeEventListener","relatedTarget","some","contains","startsWith","addEventListeners","removeEventListeners","hostConnected","hostDisconnected","hostUpdated"],"mappings":"AA8BA,SAASA,EACLC,EACAC,EACAC,GAEA,cAAWF,IAAUC,EACT,IAAMD,EACU,mBAAVA,EACPA,EAEJE,EAGJ,MAAMC,EA2FTC,WAAAA,CACIH,GAEII,mBAAAH,EACAI,UAAAC,EACAC,mBAAAC,EACAC,SAAAC,EACAC,aAAAC,EACAC,mBAAAC,EACAC,cAAAC,EACAC,wBAAAC,GACqB,CAAET,SAAUA,IAAM,KArF/CU,KAAQC,eAAgB,EAExBD,KAAQE,WAAY,EAMpBF,KAAAG,WAAa,IAAsB,OAEnCH,KAAOI,gBAAkB,EAEzBJ,KAAOf,oBAAqB,EAE5Be,KAAAZ,mBAAsBP,MAuBtBmB,KAAQK,UAAW,EAWnBL,KAAAM,cAAiBzB,GAA2B,EAK5CmB,KAAAN,mBAAsBb,IAAoB,EAO1CmB,KAAAO,eAAiB,IAAmBP,KAAKQ,KAIzCR,KAAAS,OAAS,EAETT,KAAAU,mBAAoB,EAMpBV,KAAAF,yBAA0B,EAwL1BE,KAAAW,cAAiB9B,IACb,IAAKmB,KAAKY,2BAA2B/B,GAAQ,OAE7C,MAAMC,EAAOD,EAAMgC,eACnB,IAAI1B,GAAc,EAClBL,EAAKgC,KAAMzB,IACPF,EAAca,KAAKV,SAASyB,QAAQ1B,IACb,IAAhBF,IAEXa,KAAKE,UAAYF,KAAKgB,aACtBhB,KAAKgB,aAAe7B,GAAc,EAAKA,EAAca,KAAKgB,aAEtDhB,KAAKiB,kCAAkCpC,IACvCmB,KAAKkB,qBAQblB,KAAAmB,YAAc,KAjVlB,IAAAhC,EAmVQ,MAAMN,EAAWmB,KAAKV,SACtB,IAAKT,EAASuC,OAAQ,OACtB,IAAItC,EAAeD,EAASmB,KAAKgB,cAC7BhB,KAAKgB,aAAe,MAGnBlC,IAAiBkB,KAAKN,mBAAmBZ,MAC1CkB,KAAKqB,0BAA0B,GAC/BvC,EAAeD,EAASmB,KAAKgB,eAE7BlC,GAAgBkB,KAAKN,mBAAmBZ,KACxC,OAAAK,EAAAN,EAASmB,KAAKE,aAAdf,EAA0BmC,aAAa,WAAY,MACnDxC,EAAawC,aAAa,WAAY,QAI9CtB,KAAAuB,eAAkB1C,IACVmB,KAAKiB,kCAAkCpC,IACvCmB,KAAKwB,6BAmBbxB,KAAAyB,cAAiB5C,IACb,IAAKmB,KAAK0B,gBAAgB7C,EAAM8C,MAAQ9C,EAAM+C,iBAC1C,OAEJ,IAAI9C,EAAO,EAEX,OADAkB,KAAKE,UAAYF,KAAKgB,aACdnC,EAAM8C,KACV,IAAK,aACD7C,GAAQ,EACR,MACJ,IAAK,YACDA,GAA2B,SAAnBkB,KAAKd,UAAuBc,KAAKI,gBAAkB,EAC3D,MACJ,IAAK,YACDtB,GAAQ,EACR,MACJ,IAAK,UACDA,GAA2B,SAAnBkB,KAAKd,UAAuBc,KAAKI,gBAAkB,EAC3D,MACJ,IAAK,MACDJ,KAAKgB,aAAe,EACpBlC,GAAQ,EACR,MACJ,IAAK,OACDkB,KAAKgB,aAAehB,KAAKV,SAAS8B,OAAS,EAC3CtC,GAAQ,EAGhBD,EAAMgD,iBACF7B,KAAKF,yBACLjB,EAAMiD,kBAEa,SAAnB9B,KAAKd,WAAwBc,KAAKgB,aAAelC,EAAO,EACxDkB,KAAKgB,aAAe,EAED,SAAnBhB,KAAKd,WACLc,KAAKgB,aAAelC,EAAOkB,KAAKV,SAAS8B,OAAS,EAElDpB,KAAKgB,aAAehB,KAAKV,SAAS8B,OAAS,EAE3CpB,KAAKqB,0BAA0BvC,GAInCkB,KAAKZ,mBAAmBY,KAAKV,SAASU,KAAKgB,eAC3ChB,KAAK+B,SAlRL/B,KAAKgC,iBAAmB,IAAIC,iBAAiB,KACzCjC,KAAKkC,uBAETlC,KAAKf,mBAAqBH,IAAsB,EAChDkB,KAAKF,wBAA0BC,IAA2B,EAC1DC,KAAKQ,KAAO3B,EACZmB,KAAKQ,KAAK2B,cAAcnC,MACxBA,KAAKoC,UAAY7C,EACjBS,KAAKN,mBAAqBC,GAAsBK,KAAKN,mBACrDM,KAAKG,WAAaxB,EACdQ,EACA,SACAa,KAAKG,YAETH,KAAKZ,mBAAqBC,GAAsBW,KAAKZ,mBACrDY,KAAKM,cAAgB3B,EACjBc,EACA,SACAO,KAAKM,eAETN,KAAKO,eAAiB5B,EAClBkB,EACA,SACAG,KAAKO,eAEb,CA3HA,gBAAIS,GACA,OAA2B,IAAvBhB,KAAKC,gBACLD,KAAKC,cAAgBD,KAAKR,cAEvBQ,KAAKC,cAAgBD,KAAKS,MACrC,CAEA,gBAAIO,CAAanC,GACbmB,KAAKC,cAAgBpB,EAAemB,KAAKS,MAC7C,CAMA,aAAIvB,GACA,OAAOc,KAAKG,aAahB,YAAIb,GACA,OAAKU,KAAKqC,iBACNrC,KAAKqC,eAAiBrC,KAAKoC,aAExBpC,KAAKqC,cAChB,CAIA,WAAcC,CAAQzD,GAEdA,IAAYmB,KAAKsC,UACrBtC,KAAKK,SAAWxB,EACpB,CAEA,WAAcyD,GACV,OAAOtC,KAAKK,QAChB,CAIA,kBAAIkC,GACA,OAAOvC,KAAKV,SAASU,KAAKR,aAC9B,CAEA,gBAAIA,GACA,YAAYc,cAAcN,KAAKV,UAWnCsB,0BAAAA,CAA2B/B,GACvB,YAAS0B,mBAAqBP,KAAKQ,MAC5B3B,EAAMgC,eAAe2B,SAASxC,KAAKO,iBAC9C,CA0DA2B,kBAAAA,GACI,IAC0B,GAAtBlC,KAAKC,eACLD,KAAKV,SAAS8B,QAAUpB,KAAKoC,YAAYhB,OAEzC,OACJ,MAAMvC,EAAiBmB,KAAKV,SAASU,KAAKgB,cAE1C,GADAhB,KAAKyC,oBACDzC,KAAKV,SAASkD,SAAS3D,GAAiB,OAC5C,MAAMC,EAAoBkB,KAAKgB,eAAiBhB,KAAKV,SAAS8B,OACxDjC,EAAOL,EAAoB,GAAI,EACjCA,GACAkB,KAAKqB,2BAA0B,GAEnCrB,KAAKqB,0BAA0BlC,GAC/Ba,KAAK+B,QAGTW,MAAAA,EAASpD,SAAAT,GAAkC,CAAES,SAAUA,IAAM,KACzDU,KAAK2C,WACL3C,KAAKoC,UAAYvD,EACjBmB,KAAKyC,oBACLzC,KAAK4C,SAMTC,KAAAA,GA5MJ,IAAA1D,EA6MQ,MAAMN,EAAWmB,KAAKV,SACtB,IAAKT,EAASuC,OAAQ,OACtBpB,KAAKqB,0BAA0BrB,KAAKR,aAAeQ,KAAKgB,cACxD,IAAIlC,EAAeD,EAASmB,KAAKgB,cAC7BhB,KAAKgB,aAAe,MAGnBlC,IAAiBkB,KAAKN,mBAAmBZ,MAC1CkB,KAAKqB,0BAA0B,GAC/BvC,EAAeD,EAASmB,KAAKgB,eAE7BlC,GAAgBkB,KAAKN,mBAAmBZ,KACxC,OAAAK,EAAAN,EAASmB,KAAKE,aAAdf,EAA0BmC,aAAa,WAAY,MACnDxC,EAAawC,aAAa,WAAY,OAI9CwB,WAAAA,CAAYjE,EAAUC,GA9N1B,IAAAS,EA+NQ,MAAMJ,EAAWa,KAAKV,UAAY,GAC5BD,EACDR,GAASmB,KAAKN,mBAAmBb,GAE5BM,EAAS4B,QAAQlC,IADjB,EAENQ,GAAW,IACXW,KAAKgB,aAAe3B,EACpB,OAAAE,EAAAJ,EAASa,KAAKE,aAAdX,EAA0B+B,aAAa,WAAY,OAEvDtB,KAAK+B,MAAMjD,EACf,CAEAiD,KAAAA,CAAMlD,GA3OV,IAAAQ,EA4OQ,MAAMP,EAAWkB,KAAKV,SACtB,IAAKR,EAASsC,OAAQ,OACtB,IAAIjC,EAAeL,EAASkB,KAAKgB,gBAC5B7B,IAAiBa,KAAKN,mBAAmBP,MAC1Ca,KAAKqB,0BAA0B,GAC/BlC,EAAeL,EAASkB,KAAKgB,eAE7B7B,GAAgBa,KAAKN,mBAAmBP,OAEnCa,KAAKf,oBACNH,EAASkB,KAAKE,aAAef,KAE7B,OAAAE,EAAAP,EAASkB,KAAKE,aAAdb,EAA0BiC,aAAa,WAAY,OAEvDnC,EAAa4D,SAAW,EACxB5D,EAAa4C,MAAMlD,GACfmB,KAAKf,qBAAuBe,KAAKsC,SACjCtC,KAAKkB,oBAGjB,CAEAuB,iBAAAA,CAAkB5D,EAAS,GACvBmB,KAAKgC,iBAAiBgB,oBACfhD,KAAKqC,eACZrC,KAAKS,OAAS5B,EACdoE,sBAAsB,KAClBjD,KAAKV,SAAS4D,QAASpE,IACnBkB,KAAKgC,iBAAiBmB,QAAQrE,EAAS,CACnCsE,YAAY,OAI5B,CAEA/B,yBAAAA,CAA0BxC,GACtB,MAAQuC,OAAAtC,GAAWkB,KAAKV,SACxB,IAAIH,EAAQL,EACZkB,KAAKE,UAAYF,KAAKgB,aAEtB,IAAI3B,GAAaP,EAASkB,KAAKgB,aAAenC,GAAQC,EACtD,KAEIK,GACAa,KAAKV,SAASD,KACbW,KAAKN,mBAAmBM,KAAKV,SAASD,KAEvCA,GAAaP,EAASO,EAAYR,GAAQC,EAC1CK,GAAS,EAEba,KAAKgB,aAAe3B,CACxB,CAEA6B,iBAAAA,GACIlB,KAAKQ,KAAK6C,iBAAiB,WAAYrD,KAAKuB,gBAC5CvB,KAAKQ,KAAK6C,iBAAiB,UAAWrD,KAAKyB,eAC3CzB,KAAKsC,SAAU,CACnB,CAEAd,yBAAAA,GACIxB,KAAKQ,KAAK6C,iBAAiB,UAAWrD,KAAKW,eAC3CX,KAAKQ,KAAK8C,oBAAoB,WAAYtD,KAAKuB,gBAC/CvB,KAAKQ,KAAK8C,oBAAoB,UAAWtD,KAAKyB,eAC9CzB,KAAKsC,SAAU,EAGnBrB,iCAAAA,CAAkCpC,GAC9B,MAAMC,EAAgBD,EAAM0E,cAEtBpE,EAA2Ba,KAAKV,SAASkD,SAC3C1D,GAEEO,EAAyCW,KAAKV,SAASkE,KACxDjE,GAAOA,EAAGkE,SAAS3E,IAExB,QACIK,GAA4BE,EAEpC,CA+CAqC,eAAAA,CAAgB7C,GACZ,GAAY,QAARA,GAAyB,SAARA,EACjB,OAAO,EAEX,OAAQmB,KAAKd,WACT,IAAK,aACD,MAAe,cAARL,GAA+B,eAARA,EAClC,IAAK,WACD,MAAe,YAARA,GAA6B,cAARA,EAChC,IAAK,OACL,IAAK,OACD,OAAOA,EAAI6E,WAAW,SAElC,CAkDAd,MAAAA,GACI5C,KAAK2D,mBACT,CAEAhB,QAAAA,GACI3C,KAAK4D,sBACT,CAEAD,iBAAAA,GACI3D,KAAKQ,KAAK6C,iBAAiB,UAAWrD,KAAKW,eAC3CX,KAAKQ,KAAK6C,iBAAiB,QAASrD,KAAKmB,YAC7C,CAEAyC,oBAAAA,GACI5D,KAAKQ,KAAK8C,oBAAoB,UAAWtD,KAAKW,eAC9CX,KAAKQ,KAAK8C,oBAAoB,WAAYtD,KAAKuB,gBAC/CvB,KAAKQ,KAAK8C,oBAAoB,UAAWtD,KAAKyB,eAC9CzB,KAAKQ,KAAK8C,oBAAoB,QAAStD,KAAKmB,YAChD,CAEA0C,aAAAA,GACI7D,KAAKU,mBAAoB,EACzBV,KAAK2D,mBACT,CAEAG,gBAAAA,GACI9D,KAAKgC,iBAAiBgB,aACtBhD,KAAK4D,uBAGTG,WAAAA,GACQ/D,KAAKU,oBACLV,KAAKU,mBAAoB,EACzBV,KAAKV,SAAS4D,QAASrE,IACnBmB,KAAKgC,iBAAiBmB,QAAQtE,EAAS,CACnCuE,YAAY,MAI5B"}