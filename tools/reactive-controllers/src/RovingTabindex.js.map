{"version":3,"file":"RovingTabindex.js","sourceRoot":"","sources":["RovingTabindex.ts"],"names":[],"mappings":"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","sourcesContent":["/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport type { ReactiveController, ReactiveElement } from 'lit';\n\ntype DirectionTypes = 'horizontal' | 'vertical' | 'both' | 'grid';\n\nexport class RovingTabindexController<T extends HTMLElement>\n    implements ReactiveController\n{\n    host: ReactiveElement;\n    get elements(): T[] {\n        if (!this.cachedElements) {\n            this.cachedElements = this._elements();\n        }\n        return this.cachedElements;\n    }\n    private cachedElements?: T[];\n    private _elements!: () => T[];\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    calculateFocusInIndex = (_elements: T[]): number => 0;\n    get currentIndex(): number {\n        if (this._currentIndex === -1) {\n            this._currentIndex = this.focusInIndex;\n        }\n        return this._currentIndex;\n    }\n    set currentIndex(currentIndex) {\n        this._currentIndex = currentIndex;\n    }\n    private _currentIndex = -1;\n    get focusInElement(): T {\n        return this.elements[this.focusInIndex];\n    }\n    shouldInit = true;\n    get direction(): DirectionTypes {\n        return this._direction();\n    }\n    _direction = (): DirectionTypes => 'both';\n    directionLength = 5;\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    elementEnterAction = (_el: T): void => {\n        return;\n    };\n    private set focused(focused: boolean) {\n        if (focused === this.focused) return;\n        this._focused = focused;\n        this.manageTabindexes();\n    }\n    private get focused(): boolean {\n        return this._focused;\n    }\n    private _focused = false;\n    get focusInIndex(): number {\n        return this.calculateFocusInIndex(this.elements);\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    isFocusableElement = (_el: T): boolean => true;\n    isEventWithinListenerScope(event: Event): boolean {\n        if (this._listenerScope() === this.host) return true;\n        return event.composedPath().includes(this._listenerScope());\n    }\n    _listenerScope = (): HTMLElement => this.host;\n\n    constructor(\n        host: ReactiveElement,\n        {\n            calculateFocusInIndex,\n            direction,\n            elementEnterAction,\n            elements,\n            isFocusableElement,\n            listenerScope,\n        }: {\n            calculateFocusInIndex?: (_elements: T[]) => number;\n            direction?: DirectionTypes | (() => DirectionTypes);\n            elementEnterAction?: (el: T) => void;\n            elements: () => T[];\n            isFocusableElement?: (el: T) => boolean;\n            listenerScope?: HTMLElement | (() => HTMLElement);\n        } = { elements: () => [] }\n    ) {\n        this.host = host;\n        this.host.addController(this);\n        this._elements = elements;\n        this.isFocusableElement = isFocusableElement || this.isFocusableElement;\n        if (typeof direction === 'string') {\n            this._direction = () => direction;\n        } else if (typeof direction === 'function') {\n            this._direction = direction;\n        }\n        this.calculateFocusInIndex =\n            calculateFocusInIndex || this.calculateFocusInIndex;\n        this.elementEnterAction = elementEnterAction || this.elementEnterAction;\n        if (typeof listenerScope === 'object') {\n            this._listenerScope = () => listenerScope;\n        } else if (typeof listenerScope === 'function') {\n            this._listenerScope = listenerScope;\n        }\n    }\n\n    focus(options?: FocusOptions): void {\n        this.elements[this.currentIndex]?.focus(options);\n    }\n\n    private manageIndexesAnimationFrame = 0;\n\n    clearElementCache(): void {\n        delete this.cachedElements;\n        cancelAnimationFrame(this.manageIndexesAnimationFrame);\n        this.manageIndexesAnimationFrame =\n            requestAnimationFrame(() => this.manageTabindexes());\n    }\n\n    setCurrentIndexCircularly(diff: number): void {\n        const { length } = this.elements;\n        let nextIndex = (length + this.currentIndex + diff) % length;\n        while (\n            this.elements[nextIndex] &&\n            !this.isFocusableElement(this.elements[nextIndex])\n        ) {\n            nextIndex = (length + nextIndex + diff) % length;\n        }\n        this.currentIndex = nextIndex;\n    }\n\n    hostContainsFocus(): void {\n        this.host.removeEventListener('focusin', this.handleFocusin);\n        this.host.addEventListener('focusout', this.handleFocusout);\n        this.host.addEventListener('keydown', this.handleKeydown);\n        this.focused = true;\n        const currentElement = this.elements[this.currentIndex];\n        if (!currentElement) return;\n    }\n\n    hostNoLongerContainsFocus(): void {\n        this.host.addEventListener('focusin', this.handleFocusin);\n        this.host.removeEventListener('focusout', this.handleFocusout);\n        this.host.removeEventListener('keydown', this.handleKeydown);\n        this.currentIndex = this.focusInIndex;\n        this.focused = false;\n        const currentElement = this.elements[this.currentIndex];\n        if (!currentElement) return;\n    }\n\n    hostContainsRelatedTarget(event: FocusEvent): boolean {\n        const relatedTarget = event.relatedTarget as null | Element;\n        return (\n            !this.host.contains(relatedTarget) &&\n            !this.host.shadowRoot?.contains(relatedTarget)\n        );\n    }\n\n    handleFocusin = (event: FocusEvent): void => {\n        if (!this.isEventWithinListenerScope(event)) return;\n        if (this.hostContainsRelatedTarget(event)) {\n            this.hostContainsFocus();\n        }\n        const path = event.composedPath() as T[];\n        let targetIndex: number | undefined;\n        path.find((el) => {\n            targetIndex = this.elements.indexOf(el);\n            return targetIndex !== -1;\n        });\n        this.currentIndex = targetIndex || this.currentIndex;\n    };\n\n    handleFocusout = (event: FocusEvent): void => {\n        if (this.hostContainsRelatedTarget(event)) {\n            this.hostNoLongerContainsFocus();\n        }\n    };\n\n    acceptsEventCode(code: string): boolean {\n        if (code === 'End' || code === 'Home') {\n            return true;\n        }\n        switch (this.direction) {\n            case 'horizontal':\n                return code === 'ArrowLeft' || code === 'ArrowRight';\n            case 'vertical':\n                return code === 'ArrowUp' || code === 'ArrowDown';\n            case 'both':\n            case 'grid':\n                return code.startsWith('Arrow');\n        }\n    }\n\n    handleKeydown = (event: KeyboardEvent): void => {\n        if (!this.acceptsEventCode(event.code)) {\n            return;\n        }\n        let diff = 0;\n        switch (event.code) {\n            case 'ArrowRight':\n                diff += 1;\n                event.preventDefault();\n                break;\n            case 'ArrowDown':\n                diff += this.direction === 'grid' ? this.directionLength : 1;\n                event.preventDefault();\n                break;\n            case 'ArrowLeft':\n                diff -= 1;\n                event.preventDefault();\n                break;\n            case 'ArrowUp':\n                diff -= this.direction === 'grid' ? this.directionLength : 1;\n                event.preventDefault();\n                break;\n            case 'End':\n                this.currentIndex = 0;\n                diff -= 1;\n                event.preventDefault();\n                break;\n            case 'Home':\n                this.currentIndex = this.elements.length - 1;\n                diff += 1;\n                event.preventDefault();\n                break;\n        }\n        this.setCurrentIndexCircularly(diff);\n        // To allow the `focusInIndex` to be calculated with the \"after\" state of the keyboard interaction\n        // do `elementEnterAction` _before_ focusing the next element.\n        this.elementEnterAction(this.elements[this.currentIndex]);\n        this.focus();\n    };\n\n    manageTabindexes(): void {\n        if (this.focused) {\n            this.updateTabindexes(() => -1);\n        } else {\n            this.updateTabindexes((el: HTMLElement): number | false => {\n                const containsFocusInElement = el.contains(this.focusInElement);\n                if (el === this.focusInElement) {\n                    return 0;\n                } else if (containsFocusInElement) {\n                    return false;\n                }\n                return -1;\n            });\n        }\n    }\n\n    updateTabindexes(getTabIndex: (el: HTMLElement) => number | false): void {\n        this.elements.forEach((el) => {\n            const tabIndex = getTabIndex(el);\n            if (tabIndex !== false) {\n                el.tabIndex = tabIndex;\n            } else {\n                el.removeAttribute('tabindex');\n                const updatable = el as unknown as {\n                    requestUpdate?: () => void;\n                };\n                if (updatable.requestUpdate) updatable.requestUpdate();\n            }\n        });\n    }\n\n    manage(): void {\n        this.manageTabindexes();\n        this.addEventListeners();\n    }\n\n    unmanage(): void {\n        this.updateTabindexes(() => 0);\n        this.removeEventListeners();\n    }\n\n    addEventListeners(): void {\n        this.host.addEventListener('focusin', this.handleFocusin);\n    }\n\n    removeEventListeners(): void {\n        this.host.removeEventListener('focusin', this.handleFocusin);\n        this.host.removeEventListener('focusout', this.handleFocusout);\n        this.host.removeEventListener('keydown', this.handleKeydown);\n    }\n\n    hostUpdated(): void {\n        if (this.shouldInit) {\n            this.manageTabindexes();\n            this.shouldInit = false;\n        }\n    }\n\n    hostConnected(): void {\n        this.addEventListeners();\n    }\n\n    hostDisconnected(): void {\n        this.removeEventListeners();\n    }\n}\n"]}