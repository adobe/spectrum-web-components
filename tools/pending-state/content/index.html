<html><head></head><body><sp-tab-panel class="section" value="overview"> <div class="headerContainer spectrum-Typography"><h2 id="overview" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeL">Overview</h2> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeL" href="#overview"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Overview</span></sp-link><sp-divider size="l"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">The <code class="spectrum-Code">PendingStateController</code> is a <sp-link href="https://lit.dev/docs/composition/controllers/">reactive controller</sp-link> that helps manage the pending state of a reactive element. It provides a standardized way to indicate when an element is in a pending state (such as during an asynchronous operation) by rendering a progress indicator and managing ARIA labels for accessibility.</p> <div class="headerContainer spectrum-Typography"><h3 id="features" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Features</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#features"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Features</span></sp-link><sp-divider size="m"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><strong>Visual feedback</strong>: Renders an <code class="spectrum-Code">&lt;sp-progress-circle&gt;</code> element during pending states</li> <li><strong>Accessible state management</strong>: Automatically updates ARIA labels to reflect pending status</li> <li><strong>Label caching</strong>: Preserves and restores the original <code class="spectrum-Code">aria-label</code> when transitioning states</li> <li><strong>Disabled state awareness</strong>: Respects the disabled state of the host element</li> </ul> <div class="headerContainer spectrum-Typography"><h3 id="current-limitations" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Current limitations</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#current-limitations"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Current limitations</span></sp-link><sp-divider size="m"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM"><strong>Note</strong>: This controller is currently used primarily by the <code class="spectrum-Code">&lt;sp-button&gt;</code> component, where the host element is the interactive element that needs pending state. This pattern does not work optimally for components where the interactive element requiring pending state is in the shadow DOM (e.g., Combobox and Picker).</p> <p class="spectrum-Body spectrum-Body--sizeM"><strong>Deprecation consideration</strong>: This controller may be deprecated in future versions as it's not widely adopted beyond <code class="spectrum-Code">&lt;sp-button&gt;</code>.</p> <div class="headerContainer spectrum-Typography"><h3 id="usage" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Usage</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#usage"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Usage</span></sp-link><sp-divider size="m"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM"><sp-link href="https://www.npmjs.com/package/@spectrum-web-components/reactive-controllers"><img src="https://img.shields.io/npm/v/@spectrum-web-components/reactive-controllers?style=for-the-badge" alt="See it on NPM!"></sp-link> <sp-link href="https://bundlephobia.com/result?p=@spectrum-web-components/reactive-controllers"><img src="https://img.shields.io/bundlephobia/minzip/@spectrum-web-components/reactive-controllers?style=for-the-badge" alt="How big is this package in your project?"></sp-link></p> <code-example class="language-bash" preprocessed="preprocessed"><pre class="language-bash" slot="code"><span class="token function">yarn</span> <span class="token function">add</span> @spectrum-web-components/reactive-controllers</pre></code-example> <p class="spectrum-Body spectrum-Body--sizeM">Import the <code class="spectrum-Code">PendingStateController</code> via:</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span>
    PendingStateController<span class="token punctuation">,</span>
    HostWithPendingState<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/PendingState.js'</span><span class="token punctuation">;</span></pre></code-example> <div class="headerContainer spectrum-Typography"><h3 id="examples" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Examples</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#examples"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Examples</span></sp-link><sp-divider size="m"></sp-divider></div><div class="headerContainer spectrum-Typography"><h4 id="basic-usage" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Basic usage</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#basic-usage"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Basic usage</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">A simple button component that displays a loading state with an accessible progress indicator.</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement<span class="token punctuation">,</span> TemplateResult <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> property <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit/decorators.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
    PendingStateController<span class="token punctuation">,</span>
    HostWithPendingState<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/PendingState.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> when <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit/directives/when.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AsyncButton</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token keyword">implements</span> <span class="token class-name">HostWithPendingState</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Whether the button is currently in a pending state. */</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Boolean<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">/** Whether the button is disabled. */</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Boolean<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">/** Label to announce when the button is pending. */</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> attribute<span class="token operator">:</span> <span class="token string">'pending-label'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> pendingLabel <span class="token operator">=</span> <span class="token string">'Loading'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> pendingStateController<span class="token operator">:</span> PendingStateController<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pendingStateController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PendingStateController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> TemplateResult <span class="token punctuation">{</span>
        <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;button
                ?disabled=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>disabled <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
                aria-busy=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &gt;
                &lt;slot&gt;&lt;/slot&gt;
                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>pendingStateController<span class="token punctuation">.</span><span class="token function">renderPendingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;/button&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'async-button'</span><span class="token punctuation">,</span> AsyncButton<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <p class="spectrum-Body spectrum-Body--sizeM">Usage:</p> <code-example class="language-html-no-demo" preprocessed="preprocessed"><pre class="language-html-no-demo" slot="code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>async-button</span> <span class="token attr-name">pending</span> <span class="token attr-name">pending-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Saving...<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    Save
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>async-button</span><span class="token punctuation">&gt;</span></span></pre></code-example> <div class="headerContainer spectrum-Typography"><h4 id="async-operation-handling" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Async operation handling</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#async-operation-handling"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Async operation handling</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">Handle asynchronous operations with proper pending state management and success/error event dispatching.</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement<span class="token punctuation">,</span> css <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> property <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit/decorators.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
    PendingStateController<span class="token punctuation">,</span>
    HostWithPendingState<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/PendingState.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> when <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit/directives/when.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SaveButton</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token keyword">implements</span> <span class="token class-name">HostWithPendingState</span> <span class="token punctuation">{</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Boolean<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Boolean<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> attribute<span class="token operator">:</span> <span class="token string">'pending-label'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> pendingLabel <span class="token operator">=</span> <span class="token string">'Saving'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> pendingStateController<span class="token operator">:</span> PendingStateController<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> styles <span class="token operator">=</span> css<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        :host {
            display: inline-block;
        }

        button {
            position: relative;
            padding: 8px 16px;
        }

        sp-progress-circle {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
        }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pendingStateController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PendingStateController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// Simulate async operation</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Announce success to screen readers</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">'save-success'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    detail<span class="token operator">:</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Data saved successfully'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    bubbles<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    composed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Announce error to screen readers</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">'save-error'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    detail<span class="token operator">:</span> <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Failed to save data'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    bubbles<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    composed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">saveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;button
                @click=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
                ?disabled=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>disabled <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
                aria-busy=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &gt;
                &lt;slot&gt;Save&lt;/slot&gt;
                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>pendingStateController<span class="token punctuation">.</span><span class="token function">renderPendingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;/button&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'save-button'</span><span class="token punctuation">,</span> SaveButton<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <div class="headerContainer spectrum-Typography"><h4 id="multiple-pending-states" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Multiple pending states</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#multiple-pending-states"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Multiple pending states</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">Dynamically update the pending label based on different actions being performed.</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement<span class="token punctuation">,</span> css <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> property <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit/decorators.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
    PendingStateController<span class="token punctuation">,</span>
    HostWithPendingState<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/PendingState.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> when <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit/directives/when.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ActionButton</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token keyword">implements</span> <span class="token class-name">HostWithPendingState</span> <span class="token punctuation">{</span>
    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Boolean<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Boolean<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> attribute<span class="token operator">:</span> <span class="token string">'pending-label'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> pendingLabel <span class="token operator">=</span> <span class="token string">'Processing'</span><span class="token punctuation">;</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> action <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> pendingStateController<span class="token operator">:</span> PendingStateController<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pendingStateController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PendingStateController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">performAction</span><span class="token punctuation">(</span>actionType<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>action <span class="token operator">=</span> actionType<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token comment">// Update pending label based on action</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>actionType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'save'</span><span class="token operator">:</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>pendingLabel <span class="token operator">=</span> <span class="token string">'Saving'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'delete'</span><span class="token operator">:</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>pendingLabel <span class="token operator">=</span> <span class="token string">'Deleting'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">'upload'</span><span class="token operator">:</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>pendingLabel <span class="token operator">=</span> <span class="token string">'Uploading'</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeAction</span><span class="token punctuation">(</span>actionType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">executeAction</span><span class="token punctuation">(</span>action<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;button
                @click=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performAction</span><span class="token punctuation">(</span><span class="token string">'save'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
                ?disabled=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>disabled <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
                aria-busy=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &gt;
                &lt;slot&gt;Perform Action&lt;/slot&gt;
                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">when</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pending<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>pendingStateController<span class="token punctuation">.</span><span class="token function">renderPendingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;/button&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'action-button'</span><span class="token punctuation">,</span> ActionButton<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <div class="headerContainer spectrum-Typography"><h3 id="accessibility" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Accessibility</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#accessibility"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Accessibility</span></sp-link><sp-divider size="m"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">The <code class="spectrum-Code">PendingStateController</code> includes several accessibility features, but additional considerations should be taken when implementing it:</p> <div class="headerContainer spectrum-Typography"><h4 id="aria-label-management" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">ARIA label management</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#aria-label-management"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled ARIA label management</span></sp-link><sp-divider size="s"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><strong>Automatic label updates</strong>: The controller automatically updates the <code class="spectrum-Code">aria-label</code> when entering/exiting pending state.</li> <li><strong>Label preservation</strong>: The original <code class="spectrum-Code">aria-label</code> is cached and restored when the pending state ends.</li> <li><strong>Custom pending labels</strong>: Use the <code class="spectrum-Code">pendingLabel</code> property to provide context-specific messages (e.g., "Saving...", "Uploading...").</li> </ul> <div class="headerContainer spectrum-Typography"><h4 id="screen-reader-announcements" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Screen reader announcements</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#screen-reader-announcements"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Screen reader announcements</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">The pending state changes are communicated to screen readers through:</p> <ul class="spectrum-Body spectrum-Body--sizeM"> <li><strong>aria-label changes</strong>: The <code class="spectrum-Code">aria-label</code> attribute is updated to reflect the pending state.</li> <li><strong>Progress indicator</strong>: The <code class="spectrum-Code">&lt;sp-progress-circle&gt;</code> has <code class="spectrum-Code">role="presentation"</code> to avoid redundant announcements.</li> </ul> <div class="headerContainer spectrum-Typography"><h4 id="keyboard-accessibility" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Keyboard accessibility</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#keyboard-accessibility"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Keyboard accessibility</span></sp-link><sp-divider size="s"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><strong>Disable during pending</strong>: The element should be disabled (<code class="spectrum-Code">disabled</code> attribute) or not interactive during pending states to prevent multiple submissions.</li> <li><strong>Focus management</strong>: Ensure focus remains on the element or moves appropriately after async operations complete.</li> </ul> <div class="headerContainer spectrum-Typography"><h4 id="visual-indicators" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Visual indicators</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#visual-indicators"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Visual indicators</span></sp-link><sp-divider size="s"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><strong>Progress circle</strong>: The rendered <code class="spectrum-Code">&lt;sp-progress-circle&gt;</code> provides visual feedback.</li> <li><strong>Text changes</strong>: Consider changing button text during pending states (e.g., "Save" â†’ "Saving...").</li> <li><strong>Disabled state</strong>: Apply visual styling to indicate the element is not interactive.</li> </ul> <div class="headerContainer spectrum-Typography"><h3 id="references" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">References</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#references"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled References</span></sp-link><sp-divider size="m"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><sp-link href="https://www.w3.org/WAI/WCAG21/Understanding/status-messages.html">WCAG 2.1 - Status Messages</sp-link></li> <li><sp-link href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-busy">ARIA: aria-busy attribute</sp-link></li> <li><sp-link href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-label">ARIA: aria-label attribute</sp-link></li> <li><sp-link href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles/status_role">ARIA: status role</sp-link></li> </ul> <div class="headerContainer spectrum-Typography"><h3 id="related-components" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Related components</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#related-components"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Related components</span></sp-link><sp-divider size="m"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">The <code class="spectrum-Code">PendingStateController</code> is used by:</p> <ul class="spectrum-Body spectrum-Body--sizeM"> <li><sp-link href="../../components/button/"><code class="spectrum-Code">&lt;sp-button&gt;</code></sp-link> - Primary use case for pending state</li> </ul> <div class="headerContainer spectrum-Typography"><h3 id="resources" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Resources</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#resources"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Resources</span></sp-link><sp-divider size="m"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><sp-link href="../../components/progress-circle/"><code class="spectrum-Code">&lt;sp-progress-circle&gt;</code></sp-link> - The visual indicator component</li> <li><sp-link href="https://spectrum.adobe.com/page/button/#Pending">Buttons with loading states</sp-link> - UX for pending states</li> </ul> </sp-tab-panel></body></html>