<html><head></head><body><sp-tab-panel class="section" value="overview"> <div class="headerContainer spectrum-Typography"><h2 id="overview" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeL">Overview</h2> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeL" href="#overview"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Overview</span></sp-link><sp-divider size="l"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">The <code class="spectrum-Code">ElementResolutionController</code> is a <sp-link href="https://lit.dev/docs/composition/controllers/">reactive controller</sp-link> that maintains an active reference to another element in the same DOM tree. It automatically observes the DOM tree for changes and ensures that the reference it holds is always up-to-date with the first matched element or <code class="spectrum-Code">null</code> if no match is found.</p> <div class="headerContainer spectrum-Typography"><h3 id="features" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Features</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#features"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Features</span></sp-link><sp-divider size="m"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><strong>Automatic element tracking</strong>: Maintains a live reference to elements matching a CSS selector</li> <li><strong>DOM observation</strong>: Uses <code class="spectrum-Code">MutationObserver</code> to track changes in the DOM tree</li> <li><strong>Efficient ID resolution</strong>: Optimized path for ID-based selectors</li> <li><strong>Reactive updates</strong>: Automatically triggers host updates when the resolved element changes</li> <li><strong>Scope awareness</strong>: Works within Shadow DOM and regular DOM contexts</li> </ul> <div class="headerContainer spectrum-Typography"><h3 id="usage" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Usage</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#usage"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Usage</span></sp-link><sp-divider size="m"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM"><sp-link href="https://www.npmjs.com/package/@spectrum-web-components/reactive-controllers"><img src="https://img.shields.io/npm/v/@spectrum-web-components/reactive-controllers?style=for-the-badge" alt="See it on NPM!"></sp-link> <sp-link href="https://bundlephobia.com/result?p=@spectrum-web-components/reactive-controllers"><img src="https://img.shields.io/bundlephobia/minzip/@spectrum-web-components/reactive-controllers?style=for-the-badge" alt="How big is this package in your project?"></sp-link></p> <code-example class="language-bash" preprocessed="preprocessed"><pre class="language-bash" slot="code"><span class="token function">yarn</span> <span class="token function">add</span> @spectrum-web-components/reactive-controllers</pre></code-example> <p class="spectrum-Body spectrum-Body--sizeM">Import the <code class="spectrum-Code">ElementResolutionController</code> and/or <code class="spectrum-Code">elementResolverUpdatedSymbol</code> via:</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span>
    ElementResolutionController<span class="token punctuation">,</span>
    elementResolverUpdatedSymbol<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/ElementResolution.js'</span><span class="token punctuation">;</span></pre></code-example> <div class="headerContainer spectrum-Typography"><h3 id="examples" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Examples</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#examples"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Examples</span></sp-link><sp-divider size="m"></sp-divider></div><div class="headerContainer spectrum-Typography"><h4 id="basic-usage" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Basic usage</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#basic-usage"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Basic usage</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">An <code class="spectrum-Code">ElementResolutionController</code> can be applied to a host element like the following:</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ElementResolutionController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/ElementResolution.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RootEl</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
    resolvedElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElementResolutionController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>selector <span class="token operator">=</span> <span class="token string">'.other-element'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;p&gt;
                Resolved element:
                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>element <span class="token operator">?</span> <span class="token string">'Found'</span> <span class="token operator">:</span> <span class="token string">'Not found'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;/p&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'root-el'</span><span class="token punctuation">,</span> RootEl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <p class="spectrum-Body spectrum-Body--sizeM">In this example, the selector <code class="spectrum-Code">'.other-element'</code> is supplied to the resolver, which means in the following example, <code class="spectrum-Code">this.resolvedElement.element</code> will maintain a reference to the sibling <code class="spectrum-Code">&lt;div&gt;</code> element:</p> <code-example class="language-html-no-demo" preprocessed="preprocessed"><pre class="language-html-no-demo" slot="code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root-el</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root-el</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>other-element<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></pre></code-example> <p class="spectrum-Body spectrum-Body--sizeM">The resolved reference will always be the first element matching the selector applied, so in the following example the element with content "First!" will be the reference:</p> <code-example class="language-html-no-demo" preprocessed="preprocessed"><pre class="language-html-no-demo" slot="code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root-el</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root-el</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>other-element<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>First!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>other-element<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Last.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></pre></code-example> <p class="spectrum-Body spectrum-Body--sizeM">A <sp-link href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver"><code class="spectrum-Code">MutationObserver</code></sp-link> is leveraged to track mutations to the DOM tree in which the host element resides in order to update the element reference on any changes to the content therein that could change the resolved element.</p> <div class="headerContainer spectrum-Typography"><h4 id="constructor-based-selector" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Constructor-based selector</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#constructor-based-selector"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Constructor-based selector</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">You can provide the selector in the constructor options:</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> LitElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ElementResolutionController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/ElementResolution.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FormController</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
    resolvedElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElementResolutionController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        selector<span class="token operator">:</span> <span class="token string">'#submit-button'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">handleSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'form-controller'</span><span class="token punctuation">,</span> FormController<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <div class="headerContainer spectrum-Typography"><h4 id="tracking-resolution-updates" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Tracking resolution updates</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#tracking-resolution-updates"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Tracking resolution updates</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">Changes to the resolved element reference are reported to the host element via a call to the <code class="spectrum-Code">requestUpdate()</code> method. This will be provided the <code class="spectrum-Code">elementResolverUpdatedSymbol</code> as the changed key. If your element leverages this value against the changes map, it can react directly to changes in the resolved element:</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement<span class="token punctuation">,</span> PropertyValues <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
    ElementResolutionController<span class="token punctuation">,</span>
    elementResolverUpdatedSymbol<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/ElementResolution.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RootEl</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
    resolvedElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElementResolutionController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>selector <span class="token operator">=</span> <span class="token string">'.other-element'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> override <span class="token function">willUpdate</span><span class="token punctuation">(</span>changes<span class="token operator">:</span> PropertyValues<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>changes<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>elementResolverUpdatedSymbol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Work to be done only when the element reference has been updated</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
                <span class="token string">'Resolved element changed:'</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>element
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;p&gt;
                Element status:
                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>element <span class="token operator">?</span> <span class="token string">'Found'</span> <span class="token operator">:</span> <span class="token string">'Not found'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;/p&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'root-el'</span><span class="token punctuation">,</span> RootEl<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <div class="headerContainer spectrum-Typography"><h4 id="accessible-label-resolution" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Accessible label resolution</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#accessible-label-resolution"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Accessible label resolution</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">Use <code class="spectrum-Code">ElementResolutionController</code> to resolve accessible labeling elements across shadow DOM boundaries:</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ElementResolutionController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/ElementResolution.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CustomInput</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
    labelElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElementResolutionController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        selector<span class="token operator">:</span> <span class="token string">'.input-label'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">firstUpdated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Connect input to label for accessibility</span>
        <span class="token comment">// This handles cross-root ARIA relationships</span>
        <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>labelElement<span class="token punctuation">.</span>element<span class="token punctuation">;</span>
        <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token operator">?.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>input <span class="token operator">&amp;&amp;</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> targetParent <span class="token operator">=</span> target<span class="token punctuation">.</span><span class="token function">getRootNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>targetParent <span class="token operator">===</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRootNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Same root: use aria-labelledby with ID reference</span>
                <span class="token keyword">const</span> labelId <span class="token operator">=</span> target<span class="token punctuation">.</span>id <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                target<span class="token punctuation">.</span>id <span class="token operator">=</span> labelId<span class="token punctuation">;</span>
                input<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-labelledby'</span><span class="token punctuation">,</span> labelId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// Different root: use aria-label with text content</span>
                input<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>
                    <span class="token string">'aria-label'</span><span class="token punctuation">,</span>
                    target<span class="token punctuation">.</span>textContent<span class="token operator">?.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">label-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;input type="text" /&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'custom-input'</span><span class="token punctuation">,</span> CustomInput<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <p class="spectrum-Body spectrum-Body--sizeM">Usage:</p> <code-example class="language-html-no-demo" preprocessed="preprocessed"><pre class="language-html-no-demo" slot="code"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-label<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name-label<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Enter your name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>custom-input</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>custom-input</span><span class="token punctuation">&gt;</span></span></pre></code-example> <div class="headerContainer spectrum-Typography"><h4 id="dynamic-selector-changes" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Dynamic selector changes</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#dynamic-selector-changes"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Dynamic selector changes</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">The selector can be changed dynamically, and the controller will automatically update:</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> property <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit/decorators.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ElementResolutionController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/ElementResolution.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DynamicResolver</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
    resolvedElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElementResolutionController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span>
    targetSelector <span class="token operator">=</span> <span class="token string">'.default-target'</span><span class="token punctuation">;</span>

    <span class="token function">updated</span><span class="token punctuation">(</span>changedProperties<span class="token operator">:</span> Map<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>changedProperties<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'targetSelector'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>selector <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>targetSelector<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>element
            <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Found: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolvedElement<span class="token punctuation">.</span>element<span class="token punctuation">.</span>tagName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
            <span class="token operator">:</span> <span class="token string">'Not found'</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;div role="status" aria-live="polite"&gt;
                Current target (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>targetSelector<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">): </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;/div&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'dynamic-resolver'</span><span class="token punctuation">,</span> DynamicResolver<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <div class="headerContainer spectrum-Typography"><h4 id="modal-and-overlay-management" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Modal and overlay management</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#modal-and-overlay-management"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Modal and overlay management</span></sp-link><sp-divider size="s"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">Use element resolution to manage focus trap elements in modals. The controller can find elements across shadow DOM boundaries, making it useful for overlays where content might be slotted or projected:</p> <code-example class="language-typescript" preprocessed="preprocessed"><pre class="language-typescript" slot="code"><span class="token keyword">import</span> <span class="token punctuation">{</span> html<span class="token punctuation">,</span> LitElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lit'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ElementResolutionController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@spectrum-web-components/reactive-controllers/src/ElementResolution.js'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ModalManager</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span>
    firstFocusableElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElementResolutionController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        selector<span class="token operator">:</span> <span class="token string">'[data-first-focus]'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    lastFocusableElement <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElementResolutionController</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        selector<span class="token operator">:</span> <span class="token string">'[data-last-focus]'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleKeydown<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleKeydown<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">handleKeydown</span><span class="token punctuation">(</span>event<span class="token operator">:</span> KeyboardEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token operator">===</span> <span class="token string">'Tab'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> activeElement <span class="token operator">=</span> document<span class="token punctuation">.</span>activeElement<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>shiftKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Tabbing backward</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>activeElement <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstFocusableElement<span class="token punctuation">.</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>lastFocusableElement<span class="token punctuation">.</span>element<span class="token operator">?.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// Tabbing forward</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>activeElement <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastFocusableElement<span class="token punctuation">.</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>firstFocusableElement<span class="token punctuation">.</span>element<span class="token operator">?.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            &lt;div role="dialog" aria-modal="true" aria-labelledby="dialog-title"&gt;
                &lt;h2 id="dialog-title"&gt;Modal Dialog&lt;/h2&gt;
                &lt;button data-first-focus&gt;First Action&lt;/button&gt;
                &lt;slot&gt;&lt;/slot&gt;
                &lt;button data-last-focus&gt;Cancel&lt;/button&gt;
            &lt;/div&gt;
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'modal-manager'</span><span class="token punctuation">,</span> ModalManager<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></code-example> <p class="spectrum-Body spectrum-Body--sizeM">Usage:</p> <code-example class="language-html-no-demo" preprocessed="preprocessed"><pre class="language-html-no-demo" slot="code"><span class="token comment">&lt;!-- Elements with data-first-focus/data-last-focus can be inside shadow root --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modal-manager</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modal-manager</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- Or slotted from light DOM - controller finds them regardless --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modal-manager</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">data-first-focus</span><span class="token punctuation">&gt;</span></span>Custom First Button<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Modal content...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">data-last-focus</span><span class="token punctuation">&gt;</span></span>Custom Last Button<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modal-manager</span><span class="token punctuation">&gt;</span></span></pre></code-example> <div class="headerContainer spectrum-Typography"><h3 id="accessibility" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Accessibility</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#accessibility"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Accessibility</span></sp-link><sp-divider size="m"></sp-divider></div><p class="spectrum-Body spectrum-Body--sizeM">When using <code class="spectrum-Code">ElementResolutionController</code> for accessibility-related functionality, consider these best practices:</p> <div class="headerContainer spectrum-Typography"><h4 id="label-associations" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Label associations</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#label-associations"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Label associations</span></sp-link><sp-divider size="s"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li>When resolving label elements, always use proper ARIA attributes (<code class="spectrum-Code">aria-labelledby</code>, <code class="spectrum-Code">aria-describedby</code>) to create programmatic relationships.</li> <li>Ensure labels have unique IDs that can be referenced.</li> <li>Generate IDs programmatically if they don't exist.</li> </ul> <div class="headerContainer spectrum-Typography"><h4 id="error-messages" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Error messages</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#error-messages"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Error messages</span></sp-link><sp-divider size="s"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li>Error message elements should have <code class="spectrum-Code">role="alert"</code> for screen reader announcements.</li> <li>Use <code class="spectrum-Code">aria-describedby</code> to associate error messages with form controls.</li> <li>Ensure error messages are visible and programmatically associated when validation fails.</li> </ul> <div class="headerContainer spectrum-Typography"><h4 id="focus-management" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Focus management</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#focus-management"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Focus management</span></sp-link><sp-divider size="s"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li>When resolving focusable elements, ensure they meet keyboard accessibility requirements.</li> <li>Maintain logical tab order when using resolved elements for focus trapping.</li> <li>Provide clear focus indicators for all resolved interactive elements.</li> </ul> <div class="headerContainer spectrum-Typography"><h4 id="dynamic-content" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Dynamic content</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#dynamic-content"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Dynamic content</span></sp-link><sp-divider size="s"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li>Use <code class="spectrum-Code">aria-live</code> regions when resolved elements change dynamically and users need to be notified.</li> <li>Consider using <code class="spectrum-Code">aria-live="polite"</code> for non-critical updates.</li> <li>Use <code class="spectrum-Code">aria-live="assertive"</code> sparingly for critical information.</li> </ul> <div class="headerContainer spectrum-Typography"><h4 id="element-visibility" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeS">Element visibility</h4> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeS" href="#element-visibility"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Element visibility</span></sp-link><sp-divider size="s"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li>Verify that resolved elements are visible and accessible to assistive technologies.</li> <li>Check that resolved elements aren't hidden with <code class="spectrum-Code">display: none</code> or <code class="spectrum-Code">visibility: hidden</code> unless intentional.</li> <li>Use appropriate ARIA attributes (<code class="spectrum-Code">aria-hidden</code>) when hiding decorative resolved elements.</li> </ul> <div class="headerContainer spectrum-Typography"><h3 id="performance-considerations" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">Performance considerations</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#performance-considerations"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled Performance considerations</span></sp-link><sp-divider size="m"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><strong>ID selectors are optimized</strong>: The controller uses <code class="spectrum-Code">getElementById()</code> for ID-based selectors (starting with <code class="spectrum-Code">#</code>), which is faster than <code class="spectrum-Code">querySelector()</code>.</li> <li><strong>MutationObserver scope</strong>: The observer watches the entire root node (Shadow DOM or document) for changes. For large DOMs, this could have performance implications.</li> <li><strong>Automatic cleanup</strong>: The controller automatically disconnects the MutationObserver when the host is disconnected from the DOM.</li> </ul> <div class="headerContainer spectrum-Typography"><h3 id="references" tabindex="-1" class="header-heading spectrum-Heading spectrum-Heading--sizeM">References</h3> <sp-link class="header-anchor spectrum-Heading spectrum-Heading--sizeM" href="#references"><span aria-hidden="true">#</span><span class="visually-hidden">Section titled References</span></sp-link><sp-divider size="m"></sp-divider></div><ul class="spectrum-Body spectrum-Body--sizeM"> <li><sp-link href="https://www.w3.org/WAI/WCAG21/Understanding/name-role-value.html">WCAG 2.1 - Name, Role, Value</sp-link></li> <li><sp-link href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-labelledby">ARIA: aria-labelledby attribute</sp-link></li> <li><sp-link href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Attributes/aria-describedby">ARIA: aria-describedby attribute</sp-link></li> </ul> </sp-tab-panel></body></html>