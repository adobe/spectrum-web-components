"use strict";const d="showPopover"in document.createElement("div");class l{constructor(){this.root=document.body;this.stack=[];this.originalBodyOverflow="";this.bodyScrollBlocked=!1;this.handleScroll=t=>{t.target!==document&&t.target!==document.documentElement&&t.target!==document.body||this.stack.forEach(e=>{e.open&&(e.type==="auto"&&e.triggerElement instanceof HTMLElement&&e.triggerElement.closest("sp-picker, sp-action-menu")&&t.stopPropagation(),document.dispatchEvent(new CustomEvent("sp-update-overlays",{bubbles:!0,composed:!0,cancelable:!0})))})};this.handlePointerdown=t=>{this.pointerdownPath=t.composedPath(),this.lastOverlay=this.stack[this.stack.length-1]};this.handlePointerup=()=>{const t=this.pointerdownPath;if(this.pointerdownPath=void 0,!this.stack.length||!(t!=null&&t.length))return;const e=this.lastOverlay;this.lastOverlay=void 0;const i=this.stack.length-1,r=this.stack.filter((n,s)=>!t.find(o=>o===n||o===(n==null?void 0:n.triggerElement)&&(n==null?void 0:n.type)==="hint"||s===i&&n!==e&&n.triggerInteraction==="longpress")&&!n.shouldPreventClose()&&n.type!=="manual"&&!(n.type==="modal"&&e!==n));r.reverse(),r.forEach(n=>{this.closeOverlay(n);let s=n.parentOverlayToForceClose;for(;s;)this.closeOverlay(s),s=s.parentOverlayToForceClose})};this.handleBeforetoggle=t=>{const{target:e,newState:i}=t;i!=="open"&&this.closeOverlay(e)};this.handleKeydown=t=>{if(t.code!=="Escape"||t.defaultPrevented||!this.stack.length)return;const e=this.stack[this.stack.length-1];if((e==null?void 0:e.type)==="page"){t.preventDefault();return}if((e==null?void 0:e.type)==="manual"||(e==null?void 0:e.type)==="modal"){this.closeOverlay(e);return}d||e&&this.closeOverlay(e)};this.bindEvents()}get document(){return this.root.ownerDocument||document}bindEvents(){this.document.addEventListener("pointerdown",this.handlePointerdown),this.document.addEventListener("pointerup",this.handlePointerup),this.document.addEventListener("keydown",this.handleKeydown),this.document.addEventListener("scroll",this.handleScroll,{capture:!0})}closeOverlay(t){const e=this.stack.indexOf(t);e>-1&&this.stack.splice(e,1),t.open=!1,this.manageBodyScroll()}manageBodyScroll(){const t=this.stack.some(e=>e.type==="modal"||e.type==="page");t&&!this.bodyScrollBlocked?(this.originalBodyOverflow=document.body.style.overflow||"",document.body.style.overflow="hidden",this.bodyScrollBlocked=!0):!t&&this.bodyScrollBlocked&&(document.body.style.overflow=this.originalBodyOverflow,this.bodyScrollBlocked=!1)}overlaysByTriggerElement(t){return this.stack.filter(e=>e.triggerElement===t)}add(t){if(this.stack.includes(t)){const e=this.stack.indexOf(t);e>-1&&(this.stack.splice(e,1),this.stack.push(t));return}if(t.type==="auto"||t.type==="modal"||t.type==="page"){const e="sp-overlay-query-path",i=new Event(e,{composed:!0,bubbles:!0});t.addEventListener(e,r=>{const n=r.composedPath();this.stack.forEach(s=>{const a=n.find(c=>c===s),o=t.triggerElement&&t.triggerElement instanceof HTMLElement&&s.contains&&s.contains(t.triggerElement);console.log("overlayEl.type:",s.type,"triggerInOverlay:",o,"inPath:",!!a),!a&&!o&&s.type!=="manual"&&s.type!=="modal"&&(console.log("Closing overlay:",s),this.closeOverlay(s))})},{once:!0}),t.dispatchEvent(i)}else if(t.type==="hint"){if(this.stack.some(i=>i.type!=="manual"&&i.triggerElement&&i.triggerElement===t.triggerElement)){t.open=!1;return}this.stack.forEach(i=>{i.type==="hint"&&this.closeOverlay(i)})}requestAnimationFrame(()=>{this.stack.push(t),t.addEventListener("beforetoggle",this.handleBeforetoggle,{once:!0}),this.manageBodyScroll()})}remove(t){this.closeOverlay(t)}}export const overlayStack=new l;
//# sourceMappingURL=OverlayStack.js.map
