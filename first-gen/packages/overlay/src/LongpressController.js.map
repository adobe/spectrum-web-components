{
  "version": 3,
  "sources": ["LongpressController.ts"],
  "sourcesContent": ["/**\n * Copyright 2025 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport {\n    isAndroid,\n    isIOS,\n} from '@spectrum-web-components/shared/src/platform.js';\nimport { conditionAttributeWithId } from '@spectrum-web-components/base/src/condition-attribute-with-id.js';\nimport { randomID } from '@spectrum-web-components/shared/src/random-id.js';\n\nimport { noop } from './AbstractOverlay.js';\nimport {\n    InteractionController,\n    InteractionTypes,\n} from './InteractionController.js';\n\nconst LONGPRESS_DURATION = 300;\nexport const LONGPRESS_INSTRUCTIONS = {\n    touch: 'Double tap and long press for additional options',\n    keyboard: 'Press Space or Alt+Down Arrow for additional options',\n    mouse: 'Click and hold for additional options',\n};\n\ntype LongpressEvent = {\n    source: 'pointer' | 'keyboard';\n};\n\nexport class LongpressController extends InteractionController {\n    override type = InteractionTypes.longpress;\n\n    override get activelyOpening(): boolean {\n        return (\n            this.longpressState === 'opening' ||\n            this.longpressState === 'pressed'\n        );\n    }\n\n    protected longpressState: null | 'potential' | 'opening' | 'pressed' = null;\n\n    override releaseDescription = noop;\n\n    private timeout!: ReturnType<typeof setTimeout>;\n\n    handleLongpress(): void {\n        this.open = true;\n        this.longpressState =\n            this.longpressState === 'potential' ? 'opening' : 'pressed';\n    }\n\n    handlePointerdown(event: PointerEvent): void {\n        if (!this.target) return;\n        if (event.button !== 0) return;\n        this.longpressState = 'potential';\n        document.addEventListener('pointerup', this.handlePointerup);\n        document.addEventListener('pointercancel', this.handlePointerup);\n        // Only dispatch longpress event if the trigger element isn't doing it for us.\n        const triggerHandlesLongpress = 'holdAffordance' in this.target;\n        if (triggerHandlesLongpress) return;\n        this.timeout = setTimeout(() => {\n            if (!this.target) return;\n            this.target.dispatchEvent(\n                new CustomEvent<LongpressEvent>('longpress', {\n                    bubbles: true,\n                    composed: true,\n                    detail: {\n                        source: 'pointer',\n                    },\n                })\n            );\n        }, LONGPRESS_DURATION);\n    }\n\n    private handlePointerup = (): void => {\n        clearTimeout(this.timeout);\n        if (!this.target) return;\n        // When triggered by the pointer, the last of `opened`\n        // or `pointerup` should move the `longpressState` to\n        // `null` so that the earlier event can void the \"light\n        // dismiss\" and keep the Overlay open.\n        this.longpressState =\n            this.overlay?.state === 'opening' ? 'pressed' : null;\n        document.removeEventListener('pointerup', this.handlePointerup);\n        document.removeEventListener('pointercancel', this.handlePointerup);\n    };\n\n    private handleKeydown(event: KeyboardEvent): void {\n        const { code, altKey } = event;\n        if (altKey && code === 'ArrowDown') {\n            event.stopPropagation();\n            event.stopImmediatePropagation();\n        }\n    }\n\n    private handleKeyup(event: KeyboardEvent): void {\n        const { code, altKey } = event;\n        if (code === 'Space' || (altKey && code === 'ArrowDown')) {\n            if (!this.target) {\n                return;\n            }\n            event.stopPropagation();\n            this.target.dispatchEvent(\n                new CustomEvent<LongpressEvent>('longpress', {\n                    bubbles: true,\n                    composed: true,\n                    detail: {\n                        source: 'keyboard',\n                    },\n                })\n            );\n            setTimeout(() => {\n                this.longpressState = null;\n            });\n        }\n    }\n\n    override prepareDescription(trigger: HTMLElement): void {\n        if (\n            // do not reapply until target is recycled\n            this.releaseDescription !== noop ||\n            // require \"longpress content\" to apply relationship\n            !this.overlay.elements.length\n        ) {\n            return;\n        }\n\n        const longpressDescription = document.createElement('div');\n        longpressDescription.id = `longpress-describedby-descriptor-${randomID()}`;\n        const messageType = isIOS() || isAndroid() ? 'touch' : 'keyboard';\n        longpressDescription.textContent = LONGPRESS_INSTRUCTIONS[messageType];\n        longpressDescription.slot = 'longpress-describedby-descriptor';\n        const triggerParent = trigger.getRootNode() as HTMLElement;\n        const overlayParent = this.overlay.getRootNode() as HTMLElement;\n        // Manage the placement of the helper element in an accessible place with\n        // the lowest chance of negatively affecting the layout of the page.\n        if (triggerParent === overlayParent) {\n            // Trigger and Overlay in same DOM tree...\n            // Append helper element to Overlay.\n            this.overlay.append(longpressDescription);\n        } else {\n            // If Trigger in <body>, hide helper\n            longpressDescription.hidden = !('host' in triggerParent);\n            // Trigger and Overlay in different DOM tree, Trigger in shadow tree...\n            // Insert helper element after Trigger.\n            trigger.insertAdjacentElement('afterend', longpressDescription);\n        }\n\n        const releaseDescription = conditionAttributeWithId(\n            trigger,\n            'aria-describedby',\n            [longpressDescription.id]\n        );\n        this.releaseDescription = () => {\n            releaseDescription();\n            longpressDescription.remove();\n            this.releaseDescription = noop;\n        };\n    }\n\n    override shouldCompleteOpen(): void {\n        // When triggered by the pointer, the last of `opened`\n        // or `pointerup` should move the `longpressState` to\n        // `null` so that the earlier event can void the \"light\n        // dismiss\" and keep the Overlay open.\n        this.longpressState =\n            this.longpressState === 'pressed' ? null : this.longpressState;\n    }\n\n    override init(): void {\n        // Clean up listeners if they've already been bound\n        this.abortController?.abort();\n        this.abortController = new AbortController();\n        const { signal } = this.abortController;\n        this.target.addEventListener(\n            'longpress',\n            () => this.handleLongpress(),\n            { signal }\n        );\n        this.target.addEventListener(\n            'pointerdown',\n            (event: PointerEvent) => this.handlePointerdown(event),\n            { signal }\n        );\n\n        this.prepareDescription(this.target);\n        if (\n            (this.target as HTMLElement & { holdAffordance: boolean })\n                .holdAffordance\n        ) {\n            // Only bind keyboard events when the trigger element isn't doing it for us.\n            return;\n        }\n        this.target.addEventListener(\n            'keydown',\n            (event: KeyboardEvent) => this.handleKeydown(event),\n            { signal }\n        );\n        this.target.addEventListener(\n            'keyup',\n            (event: KeyboardEvent) => this.handleKeyup(event),\n            { signal }\n        );\n    }\n}\n"],
  "mappings": "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",
  "names": ["isAndroid", "isIOS", "conditionAttributeWithId", "randomID", "noop", "InteractionController", "InteractionTypes", "LONGPRESS_DURATION", "_a", "event", "code", "altKey", "trigger", "longpressDescription", "messageType", "triggerParent", "overlayParent", "releaseDescription", "signal"]
}
