{
  "version": 3,
  "sources": ["DialogBase.ts"],
  "sourcesContent": ["/**\n * Copyright 2025 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport {\n    CSSResultArray,\n    html,\n    nothing,\n    PropertyValues,\n    SpectrumElement,\n    TemplateResult,\n} from '@spectrum-web-components/base';\nimport { property } from '@spectrum-web-components/base/src/decorators.js';\n\nimport '@spectrum-web-components/underlay/sp-underlay.js';\nimport '@spectrum-web-components/button/sp-button.js';\n\n// Leveraged in build systems that use aliasing to prevent multiple registrations: https://github.com/adobe/spectrum-web-components/pull/3225\nimport '@spectrum-web-components/dialog/sp-dialog.js';\nimport modalWrapperStyles from '@spectrum-web-components/modal/src/modal-wrapper.css.js';\nimport modalStyles from '@spectrum-web-components/modal/src/modal.css.js';\nimport { Dialog } from './Dialog.dev.js'\nimport { FocusVisiblePolyfillMixin } from '@spectrum-web-components/shared';\nimport { firstFocusableIn } from '@spectrum-web-components/shared/src/first-focusable-in.js';\n\n/**\n * @element sp-dialog-base\n *\n * @slot - A Dialog element to display.\n * @fires close - Announces that the dialog has been closed.\n */\nexport class DialogBase extends FocusVisiblePolyfillMixin(SpectrumElement) {\n    public static override get styles(): CSSResultArray {\n        return [modalWrapperStyles, modalStyles];\n    }\n\n    @property({ type: Boolean, reflect: true })\n    public dismissable = false;\n\n    @property({ type: Boolean, reflect: true })\n    public open = false;\n\n    @property({ type: String, reflect: true })\n    public mode?: 'fullscreen' | 'fullscreenTakeover';\n\n    /**\n     * When set to true, fills screens smaller than 350px high and 400px wide with the full dialog.\n     */\n    @property({ type: Boolean })\n    public responsive = false;\n\n    private transitionPromise = Promise.resolve();\n\n    private resolveTransitionPromise = (): void => {\n        return;\n    };\n\n    @property({ type: Boolean })\n    public underlay = false;\n\n    protected get dialog(): Dialog {\n        const dialog = (\n            this.shadowRoot.querySelector('slot') as HTMLSlotElement\n        ).assignedElements()[0] as Dialog;\n        if (window.__swc.DEBUG) {\n            if (!dialog) {\n                window.__swc.warn(\n                    this,\n                    `<${this.localName}> expects to be provided dialog content via its default slot.`,\n                    'https://opensource.adobe.com/spectrum-web-components/components/dialog-base/#dialog'\n                );\n            }\n        }\n        return dialog || this;\n    }\n\n    public override async focus(): Promise<void> {\n        if (this.shadowRoot) {\n            const firstFocusable = firstFocusableIn(this.dialog);\n            if (firstFocusable) {\n                if ((firstFocusable as SpectrumElement).updateComplete) {\n                    await firstFocusable.updateComplete;\n                }\n                firstFocusable.focus();\n            } else {\n                this.dialog.focus();\n            }\n            /* c8 ignore next 3 */\n        } else {\n            super.focus();\n        }\n    }\n\n    private animating = false;\n\n    public overlayWillCloseCallback(): boolean {\n        if (!this.open) return this.animating;\n        this.close();\n        return true;\n    }\n\n    private dismiss(): void {\n        if (!this.dismissable) {\n            return;\n        }\n        this.close();\n    }\n\n    protected handleClose(event: Event): void {\n        event.stopPropagation();\n        this.close();\n    }\n\n    public close(): void {\n        this.open = false;\n    }\n\n    private dispatchClosed(): void {\n        this.dispatchEvent(\n            new Event('close', {\n                bubbles: true,\n            })\n        );\n    }\n\n    private handleTransitionEvent(event: TransitionEvent): void {\n        this.dispatchEvent(\n            new TransitionEvent(event.type, {\n                bubbles: true,\n                composed: true,\n                propertyName: event.propertyName,\n            })\n        );\n    }\n\n    protected handleUnderlayTransitionend(event: TransitionEvent): void {\n        if (!this.open && event.propertyName === 'visibility') {\n            this.resolveTransitionPromise();\n        }\n        this.handleTransitionEvent(event);\n    }\n\n    protected handleModalTransitionend(event: TransitionEvent): void {\n        if (this.open || !this.underlay) {\n            this.resolveTransitionPromise();\n        }\n        this.handleTransitionEvent(event);\n    }\n\n    private get hasTransitionDuration(): boolean {\n        const modal = this.shadowRoot.querySelector('.modal') as HTMLElement;\n\n        const modalTransitionDurations =\n            window.getComputedStyle(modal).transitionDuration;\n        for (const duration of modalTransitionDurations.split(','))\n            if (parseFloat(duration) > 0) return true;\n\n        const underlay = this.shadowRoot.querySelector(\n            'sp-underlay'\n        ) as HTMLElement;\n\n        if (underlay) {\n            const underlayTransitionDurations =\n                window.getComputedStyle(underlay).transitionDuration;\n            for (const duration of underlayTransitionDurations.split(','))\n                if (parseFloat(duration) > 0) return true;\n        }\n\n        return false;\n    }\n\n    protected override update(changes: PropertyValues<this>): void {\n        if (changes.has('open') && changes.get('open') !== undefined) {\n            const hasTransitionDuration = this.hasTransitionDuration;\n            this.animating = true;\n            this.transitionPromise = new Promise((res) => {\n                this.resolveTransitionPromise = () => {\n                    this.animating = false;\n                    if (!this.open && hasTransitionDuration)\n                        this.dispatchClosed();\n                    res();\n                };\n            });\n            if (!this.open && !hasTransitionDuration) this.dispatchClosed();\n        }\n        super.update(changes);\n    }\n\n    protected renderDialog(): TemplateResult {\n        return html`\n            <slot></slot>\n        `;\n    }\n\n    protected override render(): TemplateResult {\n        return html`\n            ${this.underlay\n                ? html`\n                      <sp-underlay\n                          ?open=${this.open}\n                          @close=${this.dismiss}\n                          @transitionrun=${this.handleTransitionEvent}\n                          @transitionend=${this.handleUnderlayTransitionend}\n                          @transitioncancel=${this.handleTransitionEvent}\n                      ></sp-underlay>\n                  `\n                : nothing}\n            <div\n                class=\"modal ${this.mode}\"\n                @transitionrun=${this.handleTransitionEvent}\n                @transitionend=${this.handleModalTransitionend}\n                @transitioncancel=${this.handleTransitionEvent}\n                @close=${this.handleClose}\n            >\n                ${this.renderDialog()}\n            </div>\n        `;\n    }\n\n    protected override updated(changes: PropertyValues<this>): void {\n        if (changes.has('open')) {\n            if (this.open) {\n                if (\n                    'updateComplete' in this.dialog &&\n                    'shouldManageTabOrderForScrolling' in this.dialog\n                ) {\n                    this.dialog.updateComplete.then(() => {\n                        this.dialog.shouldManageTabOrderForScrolling();\n                    });\n                }\n            }\n        }\n    }\n\n    /**\n     * Bind the open/close transition into the update complete lifecycle so\n     * that the overlay system can wait for it to be \"visibly ready\" before\n     * attempting to throw focus into the content contained herein. Not\n     * waiting for this can cause small amounts of page scroll to happen\n     * while opening the Tray when focusable content is included: e.g. Menu\n     * elements whose selected Menu Item is not the first Menu Item.\n     */\n    protected override async getUpdateComplete(): Promise<boolean> {\n        const complete = (await super.getUpdateComplete()) as boolean;\n        await this.transitionPromise;\n        return complete;\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
