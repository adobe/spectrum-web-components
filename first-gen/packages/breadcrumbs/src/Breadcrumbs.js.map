{
  "version": 3,
  "sources": ["Breadcrumbs.ts"],
  "sourcesContent": ["/**\n * Copyright 2025 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\nimport {\n    CSSResultArray,\n    html,\n    PropertyValues,\n    SpectrumElement,\n    TemplateResult,\n} from '@spectrum-web-components/base';\nimport {\n    property,\n    query,\n    queryAssignedElements,\n    state,\n} from '@spectrum-web-components/base/src/decorators.js';\nimport '@spectrum-web-components/breadcrumbs/sp-breadcrumb-item.js';\nimport '@spectrum-web-components/icons-workflow/icons/sp-icon-folder-open.js';\nimport '@spectrum-web-components/action-menu/sp-action-menu.js';\nimport '@spectrum-web-components/menu/sp-menu-item.js';\nimport { ActionMenu } from '@spectrum-web-components/action-menu';\nimport {\n    BreadcrumbItem as BreadcrumbElement,\n    BreadcrumbSelectDetail,\n} from './BreadcrumbItem.js';\nimport {\n    createRef,\n    Ref,\n    ref,\n} from '@spectrum-web-components/base/src/directives.js';\n\nimport styles from './breadcrumbs.css.js';\nimport { ifDefined } from '@spectrum-web-components/base/src/directives.js';\n\ntype BreadcrumbItem = {\n    label?: string;\n    href?: string;\n    value: string;\n    offsetWidth: number;\n    isVisible: boolean; // false if displayed in menu overlay\n};\n\n/**\n * @element sp-breadcrumbs\n *\n * @slot icon - change the default icon of the action menu\n * @slot root - Breadcrumb item to always display\n * @slot - Breadcrumb items\n * @fires change - Announces the selected breadcrumb item\n */\nexport class Breadcrumbs extends SpectrumElement {\n    public static override get styles(): CSSResultArray {\n        return [styles];\n    }\n\n    /**\n     * Override the maximum number of visible items\n     */\n    @property({ type: Number, attribute: 'max-visible-items' })\n    public maxVisibleItems = 4;\n\n    /**\n     * Accessible name for the Breadcrumbs component\n     */\n    @property({ type: String })\n    public label = '';\n\n    /**\n     * Change the default label of the action menu\n     */\n    @property({ type: String, attribute: 'menu-label' })\n    public menuLabel = 'More items';\n\n    /**\n     *  compact option is useful for reducing the height of the breadcrumbs\n     */\n    @property({ type: Boolean })\n    public compact = false;\n\n    @queryAssignedElements({ selector: 'sp-breadcrumb-item' })\n    private breadcrumbsElements!: BreadcrumbElement[];\n\n    @queryAssignedElements({ slot: 'root', selector: 'sp-breadcrumb-item' })\n    private rootElement!: BreadcrumbElement[];\n\n    @query('#list')\n    private list!: HTMLUListElement;\n\n    @state()\n    private items: BreadcrumbItem[] = [];\n\n    @state()\n    private visibleItems = 0;\n\n    private resizeObserver: ResizeObserver | undefined;\n    private firstRender = true;\n\n    private menuRef: Ref<ActionMenu> = createRef();\n\n    private get hasMenu(): boolean {\n        return this.visibleItems < (this.breadcrumbsElements?.length ?? 0);\n    }\n\n    override connectedCallback(): void {\n        super.connectedCallback();\n\n        if (!this.hasAttribute('role')) {\n            this.setAttribute('role', 'navigation');\n        }\n\n        this.resizeObserver = new ResizeObserver(() => {\n            if (this.firstRender) {\n                // Don't adjust overflow on first render, it is adjused in slotChangeHandler\n                this.firstRender = false;\n                return;\n            }\n            this.adjustOverflow();\n        });\n\n        this.resizeObserver.observe(this);\n    }\n\n    public override disconnectedCallback(): void {\n        this.resizeObserver?.unobserve(this);\n        super.disconnectedCallback();\n    }\n\n    override updated(changes: PropertyValues): void {\n        super.updated(changes);\n\n        if (changes.has('label')) {\n            this.setAttribute('aria-label', this.label || 'Breadcrumbs');\n        }\n\n        /**\n         * Re-run the calculation of how many breadcrumbs fit in the available space.\n         * maxVisibleItems may allow us to show more items, or less\n         * compact affects the space each item occupies\n         */\n        if (changes.has('maxVisibleItems') || changes.has('compact')) {\n            this.calculateBreadcrumbItemsWidth();\n            this.adjustOverflow();\n        }\n\n        // Breadcrumbs items were added / removed, or available space changed\n        if (changes.has('visibleItems')) {\n            this.items.forEach((item, index) => {\n                this.breadcrumbsElements[index].isLastOfType =\n                    index === this.breadcrumbsElements.length - 1;\n\n                this.breadcrumbsElements[index].toggleAttribute(\n                    'hidden',\n                    !item.isVisible\n                );\n            });\n        }\n    }\n\n    /**\n     * We need to understand how much space (px) each breadcrumb item occupies,\n     * in order to know if it fits the available horizontal space.\n     */\n    private calculateBreadcrumbItemsWidth(): void {\n        this.items = this.breadcrumbsElements.map((el, index) => {\n            let width = el.offsetWidth;\n\n            /**\n             * For breadcrumbs which are hidden,\n             * we need to temporarily remove the hidden attribute to calculate the width.\n             */\n            if (el.hasAttribute('hidden')) {\n                el.removeAttribute('hidden');\n                width = el.offsetWidth;\n                el.setAttribute('hidden', '');\n            }\n\n            return {\n                label: el.innerText,\n                href: el.href,\n                value: el.value || index.toString(),\n                offsetWidth: width,\n                isVisible: true,\n            };\n        });\n    }\n\n    /**\n     * Calculate which breadcrumbs fit in the viewport, and which should be hidden.\n     */\n    private adjustOverflow(): void {\n        let occupiedSpace = 0;\n        let newVisibleItems = 0;\n        const availableSpace = this.list.clientWidth;\n\n        // Menu will always be visible if it exists.\n        if (this.hasMenu && this.menuRef.value) {\n            occupiedSpace += this.menuRef.value.offsetWidth || 0;\n        }\n\n        // Root will always be visible if it exists.\n        if (this.rootElement.length > 0) {\n            occupiedSpace += this.rootElement[0].offsetWidth;\n        }\n\n        const start = 0;\n        for (let i = this.items.length - 1; i >= start; i--) {\n            occupiedSpace += this.items[i].offsetWidth;\n            if (\n                occupiedSpace < availableSpace &&\n                newVisibleItems < Math.max(this.maxVisibleItems, 1)\n            ) {\n                // There is still enough space for this breadcrumb.\n                this.items[i].isVisible = true;\n                newVisibleItems++;\n            } else {\n                // No more space so we hide the rest.\n                for (let j = i; j >= start; j--) {\n                    this.items[j].isVisible = false;\n                }\n                break;\n            }\n        }\n\n        // Show _at least_ one visible breadcrumb item.\n        if (newVisibleItems === 0) {\n            this.items[this.items.length - 1].isVisible = true;\n            newVisibleItems++;\n        }\n\n        // Setting the visible items count will trigger an update.\n        if (newVisibleItems !== this.visibleItems) {\n            this.visibleItems = newVisibleItems;\n        }\n    }\n\n    private announceChange(value: string): void {\n        const selectDetail: BreadcrumbSelectDetail = {\n            value,\n        };\n\n        const selectionEvent = new CustomEvent('change', {\n            bubbles: true,\n            composed: true,\n            detail: selectDetail,\n        });\n\n        this.dispatchEvent(selectionEvent);\n    }\n\n    private handleSelect(\n        event: CustomEvent<BreadcrumbSelectDetail> & { target: BreadcrumbItem }\n    ): void {\n        event.stopPropagation();\n        this.announceChange(event.detail.value);\n    }\n\n    private handleMenuChange(event: Event & { target: ActionMenu }): void {\n        event.stopPropagation();\n        this.announceChange(event.target.value);\n    }\n\n    /**\n     * The truncation menu when there is not enough space to display all the breadcrumbs.\n     * It displays all options within a breadcrumb.\n     * Items are listed with the hierarchy ordered from top (root) to bottom\n     * and include the currently selected item.\n     */\n    protected renderMenu(): TemplateResult {\n        return html`\n            <sp-breadcrumb-item role=\"listitem\" class=\"is-menu\">\n                <sp-action-menu\n                    ${ref(this.menuRef)}\n                    quiet\n                    label=${this.menuLabel}\n                    selects=\"single\"\n                    value=${this.items[this.items.length - 1].value}\n                    @change=${this.handleMenuChange}\n                    slot=\"menu\"\n                >\n                    <slot slot=\"icon\" name=\"icon\">\n                        <sp-icon-folder-open class=\"icon\"></sp-icon-folder-open>\n                    </slot>\n\n                    ${this.items.map(\n                        (item) => html`\n                            <sp-menu-item\n                                href=${ifDefined(item.href)}\n                                value=${item.value}\n                            >\n                                ${item.label}\n                            </sp-menu-item>\n                        `\n                    )}\n                </sp-action-menu>\n            </sp-breadcrumb-item>\n        `;\n    }\n\n    /**\n     * Breadcrumbs were added / removed, we need to recalculate the width of each item\n     * and adjust the overflow accordingly.\n     */\n    private async slotChangeHandler(): Promise<void> {\n        if (this.breadcrumbsElements.length === 0) {\n            this.items = [];\n            this.visibleItems = 0;\n            return;\n        }\n\n        // Wait for all breadcrumb items to complete their updates\n        await Promise.all(\n            this.breadcrumbsElements.map((el) => el.updateComplete)\n        );\n\n        // Force a recalculation of widths and overflow\n        this.calculateBreadcrumbItemsWidth();\n\n        // Reset visibleItems to 0 to force a full recalculation\n        this.visibleItems = 0;\n        this.adjustOverflow();\n    }\n\n    protected override render(): TemplateResult {\n        return html`\n            <ul @breadcrumb-select=${this.handleSelect} id=\"list\">\n                <slot name=\"root\"></slot>\n                ${this.hasMenu ? this.renderMenu() : ''}\n                <slot @slotchange=${this.slotChangeHandler}></slot>\n            </ul>\n        `;\n    }\n}\n"],
  "mappings": "qNAWA,OAEI,QAAAA,EAEA,mBAAAC,MAEG,gCACP,OACI,YAAAC,EACA,SAAAC,EACA,yBAAAC,EACA,SAAAC,MACG,kDACP,MAAO,6DACP,MAAO,uEACP,MAAO,yDACP,MAAO,gDAMP,OACI,aAAAC,EAEA,OAAAC,MACG,kDAEP,OAAOC,MAAY,uBACnB,OAAS,aAAAC,MAAiB,kDAkBnB,aAAM,oBAAoBR,CAAgB,CAA1C,kCASH,KAAO,gBAAkB,EAMzB,KAAO,MAAQ,GAMf,KAAO,UAAY,aAMnB,KAAO,QAAU,GAYjB,KAAQ,MAA0B,CAAC,EAGnC,KAAQ,aAAe,EAGvB,KAAQ,YAAc,GAEtB,KAAQ,QAA2BK,EAAU,EA9C7C,WAA2B,QAAyB,CAChD,MAAO,CAACE,CAAM,CAClB,CA8CA,IAAY,SAAmB,CA3GnC,IAAAE,EAAAC,EA4GQ,OAAO,KAAK,eAAgBA,GAAAD,EAAA,KAAK,sBAAL,YAAAA,EAA0B,SAA1B,KAAAC,EAAoC,EACpE,CAES,mBAA0B,CAC/B,MAAM,kBAAkB,EAEnB,KAAK,aAAa,MAAM,GACzB,KAAK,aAAa,OAAQ,YAAY,EAG1C,KAAK,eAAiB,IAAI,eAAe,IAAM,CAC3C,GAAI,KAAK,YAAa,CAElB,KAAK,YAAc,GACnB,MACJ,CACA,KAAK,eAAe,CACxB,CAAC,EAED,KAAK,eAAe,QAAQ,IAAI,CACpC,CAEgB,sBAA6B,CAlIjD,IAAAD,GAmIQA,EAAA,KAAK,iBAAL,MAAAA,EAAqB,UAAU,MAC/B,MAAM,qBAAqB,CAC/B,CAES,QAAQE,EAA+B,CAC5C,MAAM,QAAQA,CAAO,EAEjBA,EAAQ,IAAI,OAAO,GACnB,KAAK,aAAa,aAAc,KAAK,OAAS,aAAa,GAQ3DA,EAAQ,IAAI,iBAAiB,GAAKA,EAAQ,IAAI,SAAS,KACvD,KAAK,8BAA8B,EACnC,KAAK,eAAe,GAIpBA,EAAQ,IAAI,cAAc,GAC1B,KAAK,MAAM,QAAQ,CAACC,EAAMC,IAAU,CAChC,KAAK,oBAAoBA,CAAK,EAAE,aAC5BA,IAAU,KAAK,oBAAoB,OAAS,EAEhD,KAAK,oBAAoBA,CAAK,EAAE,gBAC5B,SACA,CAACD,EAAK,SACV,CACJ,CAAC,CAET,CAMQ,+BAAsC,CAC1C,KAAK,MAAQ,KAAK,oBAAoB,IAAI,CAACE,EAAID,IAAU,CACrD,IAAIE,EAAQD,EAAG,YAMf,OAAIA,EAAG,aAAa,QAAQ,IACxBA,EAAG,gBAAgB,QAAQ,EAC3BC,EAAQD,EAAG,YACXA,EAAG,aAAa,SAAU,EAAE,GAGzB,CACH,MAAOA,EAAG,UACV,KAAMA,EAAG,KACT,MAAOA,EAAG,OAASD,EAAM,SAAS,EAClC,YAAaE,EACb,UAAW,EACf,CACJ,CAAC,CACL,CAKQ,gBAAuB,CAC3B,IAAIC,EAAgB,EAChBC,EAAkB,EACtB,MAAMC,EAAiB,KAAK,KAAK,YAG7B,KAAK,SAAW,KAAK,QAAQ,QAC7BF,GAAiB,KAAK,QAAQ,MAAM,aAAe,GAInD,KAAK,YAAY,OAAS,IAC1BA,GAAiB,KAAK,YAAY,CAAC,EAAE,aAGzC,MAAMG,EAAQ,EACd,QAASC,EAAI,KAAK,MAAM,OAAS,EAAGA,GAAKD,EAAOC,IAE5C,GADAJ,GAAiB,KAAK,MAAMI,CAAC,EAAE,YAE3BJ,EAAgBE,GAChBD,EAAkB,KAAK,IAAI,KAAK,gBAAiB,CAAC,EAGlD,KAAK,MAAMG,CAAC,EAAE,UAAY,GAC1BH,QACG,CAEH,QAASI,EAAID,EAAGC,GAAKF,EAAOE,IACxB,KAAK,MAAMA,CAAC,EAAE,UAAY,GAE9B,KACJ,CAIAJ,IAAoB,IACpB,KAAK,MAAM,KAAK,MAAM,OAAS,CAAC,EAAE,UAAY,GAC9CA,KAIAA,IAAoB,KAAK,eACzB,KAAK,aAAeA,EAE5B,CAEQ,eAAeK,EAAqB,CACxC,MAAMC,EAAuC,CACzC,MAAAD,CACJ,EAEME,EAAiB,IAAI,YAAY,SAAU,CAC7C,QAAS,GACT,SAAU,GACV,OAAQD,CACZ,CAAC,EAED,KAAK,cAAcC,CAAc,CACrC,CAEQ,aACJC,EACI,CACJA,EAAM,gBAAgB,EACtB,KAAK,eAAeA,EAAM,OAAO,KAAK,CAC1C,CAEQ,iBAAiBA,EAA6C,CAClEA,EAAM,gBAAgB,EACtB,KAAK,eAAeA,EAAM,OAAO,KAAK,CAC1C,CAQU,YAA6B,CACnC,OAAO1B;AAAA;AAAA;AAAA,sBAGOO,EAAI,KAAK,OAAO,CAAC;AAAA;AAAA,4BAEX,KAAK,SAAS;AAAA;AAAA,4BAEd,KAAK,MAAM,KAAK,MAAM,OAAS,CAAC,EAAE,KAAK;AAAA,8BACrC,KAAK,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAO7B,KAAK,MAAM,IACRM,GAASb;AAAA;AAAA,uCAEKS,EAAUI,EAAK,IAAI,CAAC;AAAA,wCACnBA,EAAK,KAAK;AAAA;AAAA,kCAEhBA,EAAK,KAAK;AAAA;AAAA,yBAGxB,CAAC;AAAA;AAAA;AAAA,SAIjB,CAMA,MAAc,mBAAmC,CAC7C,GAAI,KAAK,oBAAoB,SAAW,EAAG,CACvC,KAAK,MAAQ,CAAC,EACd,KAAK,aAAe,EACpB,MACJ,CAGA,MAAM,QAAQ,IACV,KAAK,oBAAoB,IAAKE,GAAOA,EAAG,cAAc,CAC1D,EAGA,KAAK,8BAA8B,EAGnC,KAAK,aAAe,EACpB,KAAK,eAAe,CACxB,CAEmB,QAAyB,CACxC,OAAOf;AAAA,qCACsB,KAAK,YAAY;AAAA;AAAA,kBAEpC,KAAK,QAAU,KAAK,WAAW,EAAI,EAAE;AAAA,oCACnB,KAAK,iBAAiB;AAAA;AAAA,SAGtD,CACJ,CAhRW2B,EAAA,CADNzB,EAAS,CAAE,KAAM,OAAQ,UAAW,mBAAoB,CAAC,GARjD,YASF,+BAMAyB,EAAA,CADNzB,EAAS,CAAE,KAAM,MAAO,CAAC,GAdjB,YAeF,qBAMAyB,EAAA,CADNzB,EAAS,CAAE,KAAM,OAAQ,UAAW,YAAa,CAAC,GApB1C,YAqBF,yBAMAyB,EAAA,CADNzB,EAAS,CAAE,KAAM,OAAQ,CAAC,GA1BlB,YA2BF,uBAGCyB,EAAA,CADPvB,EAAsB,CAAE,SAAU,oBAAqB,CAAC,GA7BhD,YA8BD,mCAGAuB,EAAA,CADPvB,EAAsB,CAAE,KAAM,OAAQ,SAAU,oBAAqB,CAAC,GAhC9D,YAiCD,2BAGAuB,EAAA,CADPxB,EAAM,OAAO,GAnCL,YAoCD,oBAGAwB,EAAA,CADPtB,EAAM,GAtCE,YAuCD,qBAGAsB,EAAA,CADPtB,EAAM,GAzCE,YA0CD",
  "names": ["html", "SpectrumElement", "property", "query", "queryAssignedElements", "state", "createRef", "ref", "styles", "ifDefined", "_a", "_b", "changes", "item", "index", "el", "width", "occupiedSpace", "newVisibleItems", "availableSpace", "start", "i", "j", "value", "selectDetail", "selectionEvent", "event", "__decorateClass"]
}
