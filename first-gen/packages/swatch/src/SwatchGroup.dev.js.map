{
  "version": 3,
  "sources": ["SwatchGroup.ts"],
  "sourcesContent": ["/**\n * Copyright 2025 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport {\n    CSSResultArray,\n    ElementSize,\n    html,\n    PropertyValues,\n    SizedMixin,\n    SpectrumElement,\n    TemplateResult,\n} from '@spectrum-web-components/base';\nimport {\n    property,\n    queryAssignedElements,\n} from '@spectrum-web-components/base/src/decorators.js';\nimport { RovingTabindexController } from '@spectrum-web-components/reactive-controllers/src/RovingTabindex.js';\nimport { MutationController } from '@lit-labs/observers/mutation-controller.js';\n\nimport styles from './swatch-group.css.js';\nimport type {\n    Swatch,\n    SwatchBorder,\n    SwatchRounding,\n    SwatchShape,\n} from './Swatch.dev.js'\n\nexport type SwatchGroupSizes = Exclude<ElementSize, 'xxs' | 'xl' | 'xxl'>;\nexport type SwatchSelects = 'single' | 'multiple' | undefined;\n\n/**\n * @element sp-swatch-group\n *\n * @slot - Swatch elements to manage as a group\n */\nexport class SwatchGroup extends SizedMixin(SpectrumElement, {\n    validSizes: ['xs', 's', 'm', 'l'],\n    noDefaultSize: true,\n}) {\n    public static override get styles(): CSSResultArray {\n        return [styles];\n    }\n\n    @property({ reflect: true })\n    public border: SwatchBorder;\n\n    @property({ reflect: true })\n    public density: 'compact' | 'spacious' | undefined;\n\n    @property({ reflect: true })\n    public rounding: SwatchRounding;\n\n    @property({ type: Array })\n    public get selected(): string[] {\n        return this._selected;\n    }\n\n    public set selected(selected: string[]) {\n        if (selected === this.selected) return;\n\n        const oldSelected = this.selected;\n        this._selected = selected;\n        this.requestUpdate('selected', oldSelected);\n    }\n\n    // Specifically surface `_selected` internally so that change can be made to this value internally\n    // without triggering the update lifecycle directly.\n    private _selected: string[] = [];\n\n    @property()\n    public selects: SwatchSelects;\n\n    private selectedSet = new Set<string>();\n\n    @property({ reflect: true })\n    public shape: SwatchShape;\n\n    @queryAssignedElements({ flatten: true })\n    public swatches!: Swatch[];\n\n    constructor() {\n        super();\n\n        new MutationController(this, {\n            config: {\n                attributes: true,\n                childList: true,\n                subtree: true,\n            },\n            callback: () => {\n                this.manageChange();\n            },\n        });\n    }\n\n    rovingTabindexController = new RovingTabindexController<Swatch>(this, {\n        focusInIndex: (elements: Swatch[]) => {\n            let firstEnabledIndex = -1;\n            const firstSelectedIndex = elements.findIndex((el, index) => {\n                if (!elements[firstEnabledIndex] && !el.disabled) {\n                    firstEnabledIndex = index;\n                }\n                return el.selected && !el.disabled;\n            });\n            return elements[firstSelectedIndex]\n                ? firstSelectedIndex\n                : firstEnabledIndex;\n        },\n        elements: () => this.swatches,\n        isFocusableElement: (el: Swatch) => !el.disabled,\n    });\n\n    public override focus(options?: FocusOptions): void {\n        this.rovingTabindexController.focus(options);\n    }\n\n    protected handleChange(event: Event & { target: Swatch }): void {\n        event.stopPropagation();\n        const oldSelected = this.selected;\n        if (!this.selects) {\n            event.preventDefault();\n            return;\n        }\n        if (this.selects === 'single') {\n            const { target } = event;\n            target.tabIndex = 0;\n            target.selected = true;\n            if (this.selectedSet.has(target.value)) {\n                return;\n            }\n            this.selectedSet.clear();\n            this.selectedSet.add(target.value);\n            this.rovingTabindexController.elements.forEach((child) => {\n                if (child === target) return;\n                child.selected = false;\n            });\n        } else if (this.selects === 'multiple') {\n            const { target } = event;\n            if (target.selected) {\n                this.selectedSet.add(target.value);\n            } else {\n                this.selectedSet.delete(target.value);\n            }\n        }\n        this._selected = [...this.selectedSet];\n        const applyDefault = this.dispatchEvent(\n            new Event('change', {\n                cancelable: true,\n                bubbles: true,\n            })\n        );\n        if (!applyDefault) {\n            this._selected = oldSelected;\n            event.preventDefault();\n        }\n    }\n\n    private manageChange = async (): Promise<void> => {\n        const presentSet = new Set();\n        this.selectedSet = new Set(this.selected);\n        await Promise.all(this.swatches.map((swatch) => swatch.updateComplete));\n        this.swatches.forEach((swatch) => {\n            presentSet.add(swatch.value);\n            if (swatch.selected) {\n                this.selectedSet.add(swatch.value);\n            }\n        });\n        this.selectedSet.forEach((value) => {\n            if (!presentSet.has(value)) {\n                this.selectedSet.delete(value);\n            }\n        });\n        this._selected = [...this.selectedSet];\n        this.rovingTabindexController.clearElementCache();\n    };\n\n    private getPassthroughSwatchActions(\n        changes: PropertyValues\n    ): ((swatch: Swatch) => void)[] {\n        const targetValues: {\n            border?: SwatchBorder;\n            rounding?: SwatchRounding;\n            shape?: SwatchShape;\n            size?: SwatchGroupSizes;\n            selects?: SwatchSelects;\n        } = {};\n        if (\n            changes.has('selects') &&\n            (this.selects || typeof changes.get('selects') !== 'undefined')\n        ) {\n            targetValues.selects = this.selects;\n        }\n        if (\n            changes.has('border') &&\n            (this.border || typeof changes.get('border') !== 'undefined')\n        ) {\n            targetValues.border = this.border;\n        }\n        if (\n            changes.has('rounding') &&\n            (this.rounding || typeof changes.get('rounding') !== 'undefined')\n        ) {\n            targetValues.rounding = this.rounding;\n        }\n        if (\n            changes.has('size') &&\n            (this.size !== 'm' || typeof changes.get('size') !== 'undefined')\n        ) {\n            targetValues.size = this.size as SwatchGroupSizes;\n        }\n        if (\n            changes.has('shape') &&\n            (this.shape || typeof changes.get('shape') !== 'undefined')\n        ) {\n            targetValues.shape = this.shape;\n        }\n        const passThroughSwatchActions: ((swatch: Swatch) => void)[] = [];\n        if (Object.keys(targetValues).length) {\n            passThroughSwatchActions.push((swatch) => {\n                if (window.__swc.DEBUG) {\n                    if (\n                        'selects' in targetValues &&\n                        targetValues.selects !== 'multiple' &&\n                        swatch.mixedValue\n                    ) {\n                        window.__swc.warn(\n                            this,\n                            `<sp-swatch> elements can only leverage the \"mixed-value\" attribute when their <sp-swatch-group> parent element is also leveraging \"selects=\"multiple\"\"`,\n                            'https://opensource.adobe.com/spectrum-web-components/components/swatch-group/#multiple',\n                            {\n                                type: 'accessibility',\n                            }\n                        );\n                    }\n                }\n                if ('border' in targetValues)\n                    swatch.border = targetValues.border;\n                if ('rounding' in targetValues)\n                    swatch.rounding = targetValues.rounding;\n                if ('shape' in targetValues) swatch.shape = targetValues.shape;\n                if ('size' in targetValues)\n                    swatch.size = targetValues.size as SwatchGroupSizes;\n            });\n        }\n        return passThroughSwatchActions;\n    }\n\n    private getSelectionSwatchActions(\n        changes: PropertyValues\n    ): ((swatch: Swatch) => void)[] {\n        const selectionSwatchActions: ((swatch: Swatch) => void)[] = [];\n        if (!changes.has('selects')) return selectionSwatchActions;\n        if (this.selects) {\n            this.setAttribute(\n                'role',\n                this.selects === 'single' ? 'radiogroup' : 'group'\n            );\n        } else {\n            this.removeAttribute('role');\n        }\n        const swatchRoles = {\n            single: 'radio',\n            multiple: 'checkbox',\n        };\n        const swatchRole = this.selects ? swatchRoles[this.selects] : 'button';\n        selectionSwatchActions.push((swatch) => {\n            swatch.setAttribute('role', swatchRole);\n        });\n        return selectionSwatchActions;\n    }\n\n    protected override render(): TemplateResult {\n        return html`\n            <slot\n                @change=${this.handleChange}\n                @slotchange=${this.manageChange}\n            ></slot>\n        `;\n    }\n\n    protected override willUpdate(changes: PropertyValues<this>): void {\n        const swatchActions = [\n            ...this.getPassthroughSwatchActions(changes),\n            ...this.getSelectionSwatchActions(changes),\n        ];\n\n        // Create Swatch actions that build state to be applied later.\n        let nextSelected = new Set(this.selected);\n        const currentValues = new Set();\n        if (changes.has('selected')) {\n            swatchActions.push((swatch) => {\n                currentValues.add(swatch.value);\n                if (\n                    nextSelected.has(swatch.value) ||\n                    (!this.hasUpdated && swatch.selected)\n                ) {\n                    swatch.selected = true;\n                } else {\n                    swatch.selected = false;\n                }\n            });\n        }\n\n        const doActions = (): void => {\n            nextSelected = new Set(this.selected);\n\n            // Do Swatch actions to each Swatch in the collection.\n            this.swatches.forEach((swatch) => {\n                swatchActions.forEach((action) => {\n                    action(swatch);\n                });\n            });\n\n            // Apply state built in actions back to the Swatch Group\n            if (changes.has('selected')) {\n                this._selected = [...nextSelected.values()].filter(\n                    (selectedValue) => currentValues.has(selectedValue)\n                );\n            }\n        };\n\n        if (this.hasUpdated) {\n            // Do actions immediately when the element has already updated.\n            doActions();\n        } else {\n            // On first update wait for a `slotchange` event, which is not currently managed\n            // by the element lifecycle before allowing Swatch actions to be commited.\n            this.shadowRoot.addEventListener(\n                'slotchange',\n                () => {\n                    requestAnimationFrame(doActions);\n                },\n                { once: true }\n            );\n        }\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
