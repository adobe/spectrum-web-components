{
  "version": 3,
  "sources": ["HelpTextManager.ts"],
  "sourcesContent": ["/**\n * Copyright 2025 Adobe. All rights reserved.\n * This file is licensed to you under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License. You may obtain a copy\n * of the License at http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\n * OF ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n */\n\nimport { html, TemplateResult } from '@spectrum-web-components/base';\nimport { ifDefined } from '@spectrum-web-components/base/src/directives.js';\nimport { conditionAttributeWithId } from '@spectrum-web-components/base/src/condition-attribute-with-id.js';\nimport { randomID } from '@spectrum-web-components/shared/src/random-id.js';\nimport type { HelpText } from './HelpText';\n\nexport class HelpTextManager {\n    private conditionId?: () => void;\n    private host!: HTMLElement;\n    public id!: string;\n    private mode: 'internal' | 'external' = 'internal';\n    private previousTabindex?: -1 | 0 | undefined;\n    private helpTextElement!: Element;\n    private get isInternal(): boolean {\n        return this.mode === 'internal';\n    }\n\n    constructor(\n        host: HTMLElement,\n        { mode }: { mode: 'internal' | 'external' } = { mode: 'internal' }\n    ) {\n        this.host = host;\n        this.id = `sp-help-text-${randomID()}`;\n        this.mode = mode;\n    }\n\n    public render(negative?: boolean): TemplateResult {\n        // `pass-through-help-text-${this.instanceCount}` makes the slot effectively unreachable from\n        // the outside allowing the `help-text` slot to be preferred while `negative === false`.\n        return html`\n            <div\n                id=${ifDefined(this.isInternal ? this.id : undefined)}\n                aria-live=\"assertive\"\n            >\n                <slot\n                    name=${negative\n                        ? 'negative-help-text'\n                        : `pass-through-help-text-${randomID()}`}\n                    @slotchange=${this.handleSlotchange}\n                >\n                    <slot name=\"help-text\"></slot>\n                </slot>\n            </div>\n        `;\n    }\n\n    private addId(): void {\n        const id = this.helpTextElement ? this.helpTextElement.id : this.id;\n        this.conditionId = conditionAttributeWithId(\n            this.host,\n            'aria-describedby',\n            id\n        );\n        if (this.host.hasAttribute('tabindex')) {\n            this.previousTabindex = parseFloat(\n                this.host.getAttribute('tabindex') as string\n            ) as -1 | 0;\n        }\n        this.host.tabIndex = 0;\n    }\n\n    private removeId(): void {\n        if (this.conditionId) {\n            this.conditionId();\n            delete this.conditionId;\n        }\n        if (this.helpTextElement) return;\n        if (this.previousTabindex) {\n            this.host.tabIndex = this.previousTabindex;\n        } else {\n            this.host.removeAttribute('tabindex');\n        }\n    }\n\n    private handleSlotchange = ({\n        target,\n    }: Event & { target: HTMLSlotElement }): void => {\n        this.handleHelpText(target);\n        this.handleNegativeHelpText(target);\n    };\n\n    private handleHelpText(target: HTMLSlotElement): void {\n        if (this.isInternal) return;\n\n        if (this.helpTextElement && this.helpTextElement.id === this.id) {\n            this.helpTextElement.removeAttribute('id');\n        }\n        this.removeId();\n        const assignedElements = target.assignedElements();\n        const nextHelpTextElement = assignedElements[0];\n        this.helpTextElement = nextHelpTextElement;\n        if (nextHelpTextElement) {\n            if (!nextHelpTextElement.id) {\n                nextHelpTextElement.id = this.id;\n            }\n            this.addId();\n        }\n    }\n\n    private handleNegativeHelpText(target: HTMLSlotElement): void {\n        if (target.name !== 'negative-help-text') return;\n\n        const assignedElements = target.assignedElements();\n        assignedElements.forEach(\n            (el) => ((el as unknown as HelpText).variant = 'negative')\n        );\n    }\n}\n"],
  "mappings": "aAYA,OAAS,QAAAA,MAA4B,gCACrC,OAAS,aAAAC,MAAiB,kDAC1B,OAAS,4BAAAC,MAAgC,mEACzC,OAAS,YAAAC,MAAgB,mDAGlB,aAAM,eAAgB,CAWzB,YACIC,EACA,CAAE,KAAAC,CAAK,EAAuC,CAAE,KAAM,UAAW,EACnE,CAVF,KAAQ,KAAgC,WAgExC,KAAQ,iBAAmB,CAAC,CACxB,OAAAC,CACJ,IAAiD,CAC7C,KAAK,eAAeA,CAAM,EAC1B,KAAK,uBAAuBA,CAAM,CACtC,EA1DI,KAAK,KAAOF,EACZ,KAAK,GAAK,gBAAgBD,EAAS,CAAC,GACpC,KAAK,KAAOE,CAChB,CAXA,IAAY,YAAsB,CAC9B,OAAO,KAAK,OAAS,UACzB,CAWO,OAAOE,EAAoC,CAG9C,OAAOP;AAAA;AAAA,qBAEMC,EAAU,KAAK,WAAa,KAAK,GAAK,MAAS,CAAC;AAAA;AAAA;AAAA;AAAA,2BAI1CM,EACD,qBACA,0BAA0BJ,EAAS,CAAC,EAAE;AAAA,kCAC9B,KAAK,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,SAMnD,CAEQ,OAAc,CAClB,MAAMK,EAAK,KAAK,gBAAkB,KAAK,gBAAgB,GAAK,KAAK,GACjE,KAAK,YAAcN,EACf,KAAK,KACL,mBACAM,CACJ,EACI,KAAK,KAAK,aAAa,UAAU,IACjC,KAAK,iBAAmB,WACpB,KAAK,KAAK,aAAa,UAAU,CACrC,GAEJ,KAAK,KAAK,SAAW,CACzB,CAEQ,UAAiB,CACjB,KAAK,cACL,KAAK,YAAY,EACjB,OAAO,KAAK,aAEZ,MAAK,kBACL,KAAK,iBACL,KAAK,KAAK,SAAW,KAAK,iBAE1B,KAAK,KAAK,gBAAgB,UAAU,EAE5C,CASQ,eAAeF,EAA+B,CAClD,GAAI,KAAK,WAAY,OAEjB,KAAK,iBAAmB,KAAK,gBAAgB,KAAO,KAAK,IACzD,KAAK,gBAAgB,gBAAgB,IAAI,EAE7C,KAAK,SAAS,EAEd,MAAMG,EADmBH,EAAO,iBAAiB,EACJ,CAAC,EAC9C,KAAK,gBAAkBG,EACnBA,IACKA,EAAoB,KACrBA,EAAoB,GAAK,KAAK,IAElC,KAAK,MAAM,EAEnB,CAEQ,uBAAuBH,EAA+B,CAC1D,GAAIA,EAAO,OAAS,qBAAsB,OAEjBA,EAAO,iBAAiB,EAChC,QACZI,GAASA,EAA2B,QAAU,UACnD,CACJ,CACJ",
  "names": ["html", "ifDefined", "conditionAttributeWithId", "randomID", "host", "mode", "target", "negative", "id", "nextHelpTextElement", "el"]
}
