"use strict";import{version as d}from"@spectrum-web-components/base/src/version.js";import{COLOR_VALUES as h,SCALE_VALUES as u,SYSTEM_VARIANT_VALUES as p}from"./theme-interfaces.js";const o=class o extends HTMLElement{constructor(){super();this._dir="";this._system="spectrum";this._color="";this._scale="";this._systemContextConsumers=new Map;this.trackedChildren=new Set;this._updateRequested=!1;this._contextConsumers=new Map;this.attachShadow({mode:"open"});const e=document.importNode(o.template.content,!0);this.shadowRoot.appendChild(e),this.shouldAdoptStyles(),this.addEventListener("sp-language-context",this._handleContextPresence),this.addEventListener("sp-system-context",this._handleSystemContext),this.updateComplete=this.__createDeferredPromise()}static get observedAttributes(){return["color","scale","lang","dir","system"]}set dir(e){if(e===this.dir)return;this.setAttribute("dir",e),this._dir=e;const t=e==="rtl"?e:"ltr";this.trackedChildren.forEach(s=>{s.setAttribute("dir",t)})}get dir(){return this._dir}attributeChangedCallback(e,t,s){t!==s&&(e==="color"?this.color=s:e==="scale"?this.scale=s:e==="lang"&&s?(this.lang=s,this._provideContext()):e==="system"?(this.system=s,this._provideSystemContext()):e==="dir"&&(this.dir=s))}requestUpdate(){this.shouldAdoptStyles()}get system(){const e=o.themeFragmentsByKind.get("system"),{name:t}=e&&e.get("default")||{};return this._system||t||""}set system(e){if(e===this._system)return;const t=e&&p.includes(e)?e:this.system;t!==this._system&&(this._system=t,this.requestUpdate()),t?this.setAttribute("system",t):this.removeAttribute("system")}get color(){const e=o.themeFragmentsByKind.get("color"),{name:t}=e&&e.get("default")||{};return this._color||t||""}set color(e){if(e===this._color)return;const t=e&&h.includes(e)?e:this.color;t!==this._color&&(this._color=t,this.requestUpdate()),t?this.setAttribute("color",t):this.removeAttribute("color")}get scale(){const e=o.themeFragmentsByKind.get("scale"),{name:t}=e&&e.get("default")||{};return this._scale||t||""}set scale(e){if(e===this._scale)return;const t=e&&u.includes(e)?e:this.scale;t!==this._scale&&(this._scale=t,this.requestUpdate()),t?this.setAttribute("scale",t):this.removeAttribute("scale")}get styles(){const e=[...o.themeFragmentsByKind.keys()],t=(a,i,n)=>{const l=n&&n!=="system"&&this.system!=="spectrum"?a.get(`${i}-${this.system}`):a.get(i),m=i==="spectrum"||!n||this.hasAttribute(n);if(l&&m)return l.styles},s=e.reduce((a,i)=>{const n=o.themeFragmentsByKind.get(i);let l;if(i==="app"||i==="core")l=t(n,i);else{const{[i]:m}=this;l=t(n,m,i)}return l&&a.push(l),a},[]),r=o.themeFragmentsByKind;return this.system,this.color,this.scale,[...s]}static get template(){return this.templateElement||(this.templateElement=document.createElement("template"),this.templateElement.innerHTML="<slot></slot>"),this.templateElement}_handleSystemContext(e){e.stopPropagation();const t=e.composedPath()[0];if(this._systemContextConsumers.has(t))return;const s=()=>this._systemContextConsumers.delete(t);this._systemContextConsumers.set(t,[e.detail.callback,s]);const[r]=this._systemContextConsumers.get(t)||[];r&&r(this.system,s)}__createDeferredPromise(){return new Promise(e=>{this.__resolve=e})}connectedCallback(){if(this.shouldAdoptStyles(),o.instances.add(this),!this.hasAttribute("dir")){let e=this.assignedSlot||this.parentNode;for(;e!==document.documentElement&&!(e instanceof o);)e=e.assignedSlot||e.parentNode||e.host;this.dir=e.dir==="rtl"?e.dir:"ltr"}}disconnectedCallback(){o.instances.delete(this)}startManagingContentDirection(e){this.trackedChildren.add(e)}stopManagingContentDirection(e){this.trackedChildren.delete(e)}async shouldAdoptStyles(){this._updateRequested||(this.updateComplete=this.__createDeferredPromise(),this._updateRequested=!0,this._updateRequested=await!1,this.adoptStyles(),this.__resolve(!0))}adoptStyles(){const e=this.styles,t=[];for(const s of e)t.push(s.styleSheet);this.shadowRoot.adoptedStyleSheets=t}static registerThemeFragment(e,t,s){const r=o.themeFragmentsByKind.get(t)||new Map;r.size===0&&(o.themeFragmentsByKind.set(t,r),r.set("default",{name:e,styles:s}),o.defaultFragments.add(e)),r.set(e,{name:e,styles:s}),o.instances.forEach(a=>a.shouldAdoptStyles())}_provideContext(){this._contextConsumers.forEach(([e,t])=>e(this.lang,t))}_provideSystemContext(){this._systemContextConsumers.forEach(([e,t])=>e(this.system,t))}_handleContextPresence(e){e.stopPropagation();const t=e.composedPath()[0];if(this._contextConsumers.has(t))return;this._contextConsumers.set(t,[e.detail.callback,()=>this._contextConsumers.delete(t)]);const[s,r]=this._contextConsumers.get(t)||[];s&&r&&s(this.lang||document.documentElement.lang||navigator.language,r)}};o.themeFragmentsByKind=new Map,o.defaultFragments=new Set(["spectrum"]),o.instances=new Set,o.VERSION=d;export let Theme=o;function k(g,c,e,t,s){}
//# sourceMappingURL=Theme.js.map
