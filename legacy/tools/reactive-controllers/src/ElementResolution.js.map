{
  "version": 3,
  "sources": ["ElementResolution.ts"],
  "sourcesContent": ["/*\nCopyright 2022 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport type { ReactiveController, ReactiveElement } from 'lit';\nexport const elementResolverUpdatedSymbol = Symbol('element resolver updated');\n\nexport class ElementResolutionController implements ReactiveController {\n    get element(): HTMLElement | null {\n        return this._element;\n    }\n\n    set element(element: HTMLElement | null) {\n        if (element === this.element) return;\n        const previous = this.element;\n        this._element = element;\n        // requestUpdate leveraging the exported Symbol() so that the\n        // changes can be easily tracked in the host element.\n        this.host.requestUpdate(elementResolverUpdatedSymbol, previous);\n    }\n\n    private _element: HTMLElement | null = null;\n\n    private host!: ReactiveElement;\n\n    private observer!: MutationObserver;\n\n    get selector(): string {\n        return this._selector;\n    }\n\n    set selector(selector: string) {\n        if (selector === this.selector) return;\n        this.releaseElement();\n        this._selector = selector;\n        this.resolveElement();\n    }\n\n    private _selector = '';\n\n    get selectorAsId(): string {\n        return this.selector.slice(1);\n    }\n\n    get selectorIsId(): boolean {\n        return !!this.selector && this.selector.startsWith('#');\n    }\n\n    constructor(\n        host: ReactiveElement,\n        { selector }: { selector: string } = { selector: '' }\n    ) {\n        this.host = host;\n        this.selector = selector;\n        this.observer = new MutationObserver(this.mutationCallback);\n        // Add the controller after the MutationObserver has been created in preparation\n        // for the `hostConnected`/`hostDisconnected` callbacks to be run.\n        this.host.addController(this);\n    }\n\n    protected mutationCallback: MutationCallback = (mutationList) => {\n        let needsResolution = false;\n        mutationList.forEach((mutation) => {\n            if (needsResolution) return;\n            if (mutation.type === 'childList') {\n                const currentElementRemoved =\n                    this.element &&\n                    [...mutation.removedNodes].includes(this.element);\n                const matchingElementAdded =\n                    !!this.selector &&\n                    ([...mutation.addedNodes] as HTMLElement[]).some(\n                        this.elementIsSelected\n                    );\n                needsResolution =\n                    needsResolution ||\n                    currentElementRemoved ||\n                    matchingElementAdded;\n            }\n            if (mutation.type === 'attributes') {\n                const attributeChangedOnCurrentElement =\n                    mutation.target === this.element;\n                const attributeChangedOnMatchingElement =\n                    !!this.selector &&\n                    this.elementIsSelected(mutation.target as HTMLElement);\n                needsResolution =\n                    needsResolution ||\n                    attributeChangedOnCurrentElement ||\n                    attributeChangedOnMatchingElement;\n            }\n        });\n        if (needsResolution) {\n            this.resolveElement();\n        }\n    };\n\n    public hostConnected(): void {\n        this.resolveElement();\n        this.observer.observe(this.host.getRootNode(), {\n            subtree: true,\n            childList: true,\n            attributes: true,\n        });\n    }\n\n    public hostDisconnected(): void {\n        this.releaseElement();\n        this.observer.disconnect();\n    }\n\n    private resolveElement(): void {\n        if (!this.selector) {\n            this.releaseElement();\n            return;\n        }\n\n        const parent = this.host.getRootNode() as ShadowRoot;\n        this.element = this.selectorIsId\n            ? (parent.getElementById(this.selectorAsId) as HTMLElement)\n            : (parent.querySelector(this.selector) as HTMLElement);\n    }\n\n    private releaseElement(): void {\n        this.element = null;\n    }\n\n    private elementIsSelected = (el: HTMLElement): boolean => {\n        return this.selectorIsId\n            ? el?.id === this.selectorAsId\n            : el?.matches?.(this.selector);\n    };\n}\n"],
  "mappings": "aAaO,aAAM,6BAA+B,OAAO,0BAA0B,EAEtE,aAAM,2BAA0D,CAyCnE,YACIA,EACA,CAAE,SAAAC,CAAS,EAA0B,CAAE,SAAU,EAAG,EACtD,CA9BF,KAAQ,SAA+B,KAiBvC,KAAQ,UAAY,GAsBpB,KAAU,iBAAsCC,GAAiB,CAC7D,IAAIC,EAAkB,GACtBD,EAAa,QAASE,GAAa,CAC/B,GAAI,CAAAD,EACJ,IAAIC,EAAS,OAAS,YAAa,CAC/B,MAAMC,EACF,KAAK,SACL,CAAC,GAAGD,EAAS,YAAY,EAAE,SAAS,KAAK,OAAO,EAC9CE,EACF,CAAC,CAAC,KAAK,UACN,CAAC,GAAGF,EAAS,UAAU,EAAoB,KACxC,KAAK,iBACT,EACJD,EACIA,GACAE,GACAC,CACR,CACA,GAAIF,EAAS,OAAS,aAAc,CAChC,MAAMG,EACFH,EAAS,SAAW,KAAK,QACvBI,EACF,CAAC,CAAC,KAAK,UACP,KAAK,kBAAkBJ,EAAS,MAAqB,EACzDD,EACIA,GACAI,GACAC,CACR,EACJ,CAAC,EACGL,GACA,KAAK,eAAe,CAE5B,EAgCA,KAAQ,kBAAqBM,GAA6B,CArI9D,IAAAC,EAsIQ,OAAO,KAAK,cACND,GAAA,YAAAA,EAAI,MAAO,KAAK,cAChBC,EAAAD,GAAA,YAAAA,EAAI,UAAJ,YAAAC,EAAA,KAAAD,EAAc,KAAK,SAC7B,EA7EI,KAAK,KAAOT,EACZ,KAAK,SAAWC,EAChB,KAAK,SAAW,IAAI,iBAAiB,KAAK,gBAAgB,EAG1D,KAAK,KAAK,cAAc,IAAI,CAChC,CAlDA,IAAI,SAA8B,CAC9B,OAAO,KAAK,QAChB,CAEA,IAAI,QAAQU,EAA6B,CACrC,GAAIA,IAAY,KAAK,QAAS,OAC9B,MAAMC,EAAW,KAAK,QACtB,KAAK,SAAWD,EAGhB,KAAK,KAAK,cAAc,6BAA8BC,CAAQ,CAClE,CAQA,IAAI,UAAmB,CACnB,OAAO,KAAK,SAChB,CAEA,IAAI,SAASX,EAAkB,CACvBA,IAAa,KAAK,WACtB,KAAK,eAAe,EACpB,KAAK,UAAYA,EACjB,KAAK,eAAe,EACxB,CAIA,IAAI,cAAuB,CACvB,OAAO,KAAK,SAAS,MAAM,CAAC,CAChC,CAEA,IAAI,cAAwB,CACxB,MAAO,CAAC,CAAC,KAAK,UAAY,KAAK,SAAS,WAAW,GAAG,CAC1D,CAiDO,eAAsB,CACzB,KAAK,eAAe,EACpB,KAAK,SAAS,QAAQ,KAAK,KAAK,YAAY,EAAG,CAC3C,QAAS,GACT,UAAW,GACX,WAAY,EAChB,CAAC,CACL,CAEO,kBAAyB,CAC5B,KAAK,eAAe,EACpB,KAAK,SAAS,WAAW,CAC7B,CAEQ,gBAAuB,CAC3B,GAAI,CAAC,KAAK,SAAU,CAChB,KAAK,eAAe,EACpB,MACJ,CAEA,MAAMY,EAAS,KAAK,KAAK,YAAY,EACrC,KAAK,QAAU,KAAK,aACbA,EAAO,eAAe,KAAK,YAAY,EACvCA,EAAO,cAAc,KAAK,QAAQ,CAC7C,CAEQ,gBAAuB,CAC3B,KAAK,QAAU,IACnB,CAOJ",
  "names": ["host", "selector", "mutationList", "needsResolution", "mutation", "currentElementRemoved", "matchingElementAdded", "attributeChangedOnCurrentElement", "attributeChangedOnMatchingElement", "el", "_a", "element", "previous", "parent"]
}
