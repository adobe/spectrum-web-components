{
  "version": 3,
  "sources": ["Breadcrumbs.ts"],
  "sourcesContent": ["/*\nCopyright 2024 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\nimport {\n    CSSResultArray,\n    html,\n    PropertyValues,\n    SpectrumElement,\n    TemplateResult,\n} from '@spectrum-web-components/base';\nimport {\n    property,\n    query,\n    queryAssignedElements,\n    state,\n} from '@spectrum-web-components/base/src/decorators.js';\nimport '@spectrum-web-components/breadcrumbs/sp-breadcrumb-item.js';\nimport '@spectrum-web-components/icons-workflow/icons/sp-icon-folder-open.js';\nimport '@spectrum-web-components/action-menu/sp-action-menu.js';\nimport '@spectrum-web-components/menu/sp-menu-item.js';\nimport { ActionMenu } from '@spectrum-web-components/action-menu';\nimport {\n    BreadcrumbItem as BreadcrumbElement,\n    BreadcrumbSelectDetail,\n} from './BreadcrumbItem.dev.js'\nimport {\n    createRef,\n    Ref,\n    ref,\n} from '@spectrum-web-components/base/src/directives.js';\n\nimport styles from './breadcrumbs.css.js';\nimport { ifDefined } from '@spectrum-web-components/base/src/directives.js';\n\ntype BreadcrumbItem = {\n    label?: string;\n    href?: string;\n    value: string;\n    offsetWidth: number;\n    isVisible: boolean; // false if displayed in menu overlay\n};\n\n/**\n * @element sp-breadcrumbs\n *\n * @slot icon - change the default icon of the action menu\n * @slot root - Breadcrumb item to always display\n * @slot - Breadcrumb items\n * @fires change - Announces the selected breadcrumb item\n */\nexport class Breadcrumbs extends SpectrumElement {\n    public static override get styles(): CSSResultArray {\n        return [styles];\n    }\n\n    /**\n     * Override the maximum number of visible items\n     */\n    @property({ type: Number, attribute: 'max-visible-items' })\n    public maxVisibleItems = 4;\n\n    /**\n     * Accessible name for the Breadcrumbs component\n     */\n    @property({ type: String })\n    public label = '';\n\n    /**\n     * Change the default label of the action menu\n     */\n    @property({ type: String, attribute: 'menu-label' })\n    public menuLabel = 'More items';\n\n    /**\n     *  compact option is useful for reducing the height of the breadcrumbs\n     */\n    @property({ type: Boolean })\n    public compact = false;\n\n    @queryAssignedElements({ selector: 'sp-breadcrumb-item' })\n    private breadcrumbsElements!: BreadcrumbElement[];\n\n    @queryAssignedElements({ slot: 'root', selector: 'sp-breadcrumb-item' })\n    private rootElement!: BreadcrumbElement[];\n\n    @query('#list')\n    private list!: HTMLUListElement;\n\n    @state()\n    private items: BreadcrumbItem[] = [];\n\n    @state()\n    private visibleItems = 0;\n\n    private resizeObserver: ResizeObserver | undefined;\n    private firstRender = true;\n\n    private menuRef: Ref<ActionMenu> = createRef();\n\n    private get hasMenu(): boolean {\n        return this.visibleItems < (this.breadcrumbsElements?.length ?? 0);\n    }\n\n    override connectedCallback(): void {\n        super.connectedCallback();\n\n        if (!this.hasAttribute('role')) {\n            this.setAttribute('role', 'navigation');\n        }\n\n        this.resizeObserver = new ResizeObserver(() => {\n            if (this.firstRender) {\n                // Don't adjust overflow on first render, it is adjused in slotChangeHandler\n                this.firstRender = false;\n                return;\n            }\n            this.adjustOverflow();\n        });\n\n        this.resizeObserver.observe(this);\n    }\n\n    public override disconnectedCallback(): void {\n        this.resizeObserver?.unobserve(this);\n        super.disconnectedCallback();\n    }\n\n    override updated(changes: PropertyValues): void {\n        super.updated(changes);\n\n        if (changes.has('label')) {\n            this.setAttribute('aria-label', this.label || 'Breadcrumbs');\n        }\n\n        /**\n         * Re-run the calculation of how many breadcrumbs fit in the available space.\n         * maxVisibleItems may allow us to show more items, or less\n         * compact affects the space each item occupies\n         */\n        if (changes.has('maxVisibleItems') || changes.has('compact')) {\n            this.calculateBreadcrumbItemsWidth();\n            this.adjustOverflow();\n        }\n\n        // Breadcrumbs items were added / removed, or available space changed\n        if (changes.has('visibleItems')) {\n            this.items.forEach((item, index) => {\n                this.breadcrumbsElements[index].isLastOfType =\n                    index === this.breadcrumbsElements.length - 1;\n\n                this.breadcrumbsElements[index].toggleAttribute(\n                    'hidden',\n                    !item.isVisible\n                );\n            });\n        }\n    }\n\n    /**\n     * We need to understand how much space (px) each breadcrumb item occupies,\n     * in order to know if it fits the available horizontal space.\n     */\n    private calculateBreadcrumbItemsWidth(): void {\n        this.items = this.breadcrumbsElements.map((el, index) => {\n            let width = el.offsetWidth;\n\n            /**\n             * For breadcrumbs which are hidden,\n             * we need to temporarily remove the hidden attribute to calculate the width.\n             */\n            if (el.hasAttribute('hidden')) {\n                el.removeAttribute('hidden');\n                width = el.offsetWidth;\n                el.setAttribute('hidden', '');\n            }\n\n            return {\n                label: el.innerText,\n                href: el.href,\n                value: el.value || index.toString(),\n                offsetWidth: width,\n                isVisible: true,\n            };\n        });\n    }\n\n    /**\n     * Calculate which breadcrumbs fit in the viewport, and which should be hidden.\n     */\n    private adjustOverflow(): void {\n        let occupiedSpace = 0;\n        let newVisibleItems = 0;\n        const availableSpace = this.list.clientWidth;\n\n        // Menu will always be visible if it exists.\n        if (this.hasMenu && this.menuRef.value) {\n            occupiedSpace += this.menuRef.value.offsetWidth || 0;\n        }\n\n        // Root will always be visible if it exists.\n        if (this.rootElement.length > 0) {\n            occupiedSpace += this.rootElement[0].offsetWidth;\n        }\n\n        const start = 0;\n        for (let i = this.items.length - 1; i >= start; i--) {\n            occupiedSpace += this.items[i].offsetWidth;\n            if (\n                occupiedSpace < availableSpace &&\n                newVisibleItems < Math.max(this.maxVisibleItems, 1)\n            ) {\n                // There is still enough space for this breadcrumb.\n                this.items[i].isVisible = true;\n                newVisibleItems++;\n            } else {\n                // No more space so we hide the rest.\n                for (let j = i; j >= start; j--) {\n                    this.items[j].isVisible = false;\n                }\n                break;\n            }\n        }\n\n        // Show _at least_ one visible breadcrumb item.\n        if (newVisibleItems === 0) {\n            this.items[this.items.length - 1].isVisible = true;\n            newVisibleItems++;\n        }\n\n        // Setting the visible items count will trigger an update.\n        if (newVisibleItems !== this.visibleItems) {\n            this.visibleItems = newVisibleItems;\n        }\n    }\n\n    private announceChange(value: string): void {\n        const selectDetail: BreadcrumbSelectDetail = {\n            value,\n        };\n\n        const selectionEvent = new CustomEvent('change', {\n            bubbles: true,\n            composed: true,\n            detail: selectDetail,\n        });\n\n        this.dispatchEvent(selectionEvent);\n    }\n\n    private handleSelect(\n        event: CustomEvent<BreadcrumbSelectDetail> & { target: BreadcrumbItem }\n    ): void {\n        event.stopPropagation();\n        this.announceChange(event.detail.value);\n    }\n\n    private handleMenuChange(event: Event & { target: ActionMenu }): void {\n        event.stopPropagation();\n        this.announceChange(event.target.value);\n    }\n\n    /**\n     * The truncation menu when there is not enough space to display all the breadcrumbs.\n     * It displays all options within a breadcrumb.\n     * Items are listed with the hierarchy ordered from top (root) to bottom\n     * and include the currently selected item.\n     */\n    protected renderMenu(): TemplateResult {\n        return html`\n            <sp-breadcrumb-item role=\"listitem\" class=\"is-menu\">\n                <sp-action-menu\n                    ${ref(this.menuRef)}\n                    quiet\n                    label=${this.menuLabel}\n                    selects=\"single\"\n                    value=${this.items[this.items.length - 1].value}\n                    @change=${this.handleMenuChange}\n                    slot=\"menu\"\n                >\n                    <slot slot=\"icon\" name=\"icon\">\n                        <sp-icon-folder-open class=\"icon\"></sp-icon-folder-open>\n                    </slot>\n\n                    ${this.items.map(\n                        (item) => html`\n                            <sp-menu-item\n                                href=${ifDefined(item.href)}\n                                value=${item.value}\n                            >\n                                ${item.label}\n                            </sp-menu-item>\n                        `\n                    )}\n                </sp-action-menu>\n            </sp-breadcrumb-item>\n        `;\n    }\n\n    /**\n     * Breadcrumbs were added / removed, we need to recalculate the width of each item\n     * and adjust the overflow accordingly.\n     */\n    private async slotChangeHandler(): Promise<void> {\n        if (this.breadcrumbsElements.length === 0) {\n            this.items = [];\n            this.visibleItems = 0;\n            return;\n        }\n\n        // Wait for all breadcrumb items to complete their updates\n        await Promise.all(\n            this.breadcrumbsElements.map((el) => el.updateComplete)\n        );\n\n        // Force a recalculation of widths and overflow\n        this.calculateBreadcrumbItemsWidth();\n\n        // Reset visibleItems to 0 to force a full recalculation\n        this.visibleItems = 0;\n        this.adjustOverflow();\n    }\n\n    protected override render(): TemplateResult {\n        return html`\n            <ul @breadcrumb-select=${this.handleSelect} id=\"list\">\n                <slot name=\"root\"></slot>\n                ${this.hasMenu ? this.renderMenu() : ''}\n                <slot @slotchange=${this.slotChangeHandler}></slot>\n            </ul>\n        `;\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
