{
  "version": 3,
  "sources": ["OverlayTrigger.ts"],
  "sourcesContent": ["/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport {\n    CSSResultArray,\n    html,\n    PropertyValues,\n    SpectrumElement,\n    TemplateResult,\n} from '@spectrum-web-components/base';\nimport {\n    property,\n    query,\n    state,\n} from '@spectrum-web-components/base/src/decorators.js';\nimport type { Placement } from '@floating-ui/dom';\n\nimport type { BeforetoggleOpenEvent } from './events.js';\nimport type { Overlay } from './Overlay.js';\nimport type { OverlayTriggerInteractions } from './overlay-types';\nimport '@spectrum-web-components/overlay/sp-overlay.js';\n\nimport overlayTriggerStyles from './overlay-trigger.css.js';\n\nexport type OverlayContentTypes = 'click' | 'hover' | 'longpress';\n\n// Helper type to create all unique combinations of OverlayContentTypes\ntype Combinations<T extends string, U extends string = T> = T extends string\n    ? T | `${T} ${Combinations<Exclude<U, T>>}`\n    : never;\n\nexport type TriggeredByType = Combinations<OverlayContentTypes>;\n\n/**\n * @element overlay-trigger\n *\n * A component that manages overlay content triggered by different interactions.\n * Supports click, hover, and longpress triggered overlays with configurable\n * placement and behavior.\n *\n * @slot trigger - The content that will trigger the various overlays\n * @slot hover-content - The content that will be displayed on hover\n * @slot click-content - The content that will be displayed on click\n * @slot longpress-content - The content that will be displayed on longpress\n * @slot longpress-describedby-descriptor - Description for longpress content\n *\n * @fires sp-opened - Announces that the overlay has been opened\n * @fires sp-closed - Announces that the overlay has been closed\n *\n * @attr {string} placement - The placement of the overlay relative to the trigger\n * @attr {number} offset - The distance between the overlay and the trigger\n * @attr {boolean} disabled - Whether the overlay trigger is disabled\n * @attr {string} receives-focus - How focus should be handled ('true'|'false'|'auto')\n * @attr {string} triggered-by - The type of interaction that will trigger the overlay ('click'|'hover'|'longpress')\n */\nexport class OverlayTrigger extends SpectrumElement {\n    public static override get styles(): CSSResultArray {\n        return [overlayTriggerStyles];\n    }\n\n    /**\n     * Optional property to optimize performance and prevent race conditions.\n     *\n     * By explicitly declaring which content types are used (e.g. \"click\", \"longpress hover\"),\n     * we can avoid:\n     * 1. Extra renders from unnecessary slot reparenting\n     * 2. Potential infinite render loops during content detection\n     * 3. Race conditions during slot assignment\n     *\n     * By only returning overlay wrappers for explicitly declared content types,\n     * we minimize unecessary DOM nodes, operations and ensure a more stable rendering behavior.\n     */\n    @property({ attribute: 'triggered-by' })\n    public triggeredBy?: TriggeredByType;\n\n    /**\n     * @type {\"top\" | \"top-start\" | \"top-end\" | \"right\" | \"right-start\" | \"right-end\" | \"bottom\" | \"bottom-start\" | \"bottom-end\" | \"left\" | \"left-start\" | \"left-end\"}\n     * @attr\n     */\n    @property({ reflect: true })\n    public placement?: Placement;\n\n    @property()\n    public type?: OverlayTriggerInteractions;\n\n    @property({ type: Number })\n    public offset = 6;\n\n    @property({ reflect: true })\n    public open?: OverlayContentTypes;\n\n    @property({ type: Boolean, reflect: true })\n    public disabled = false;\n\n    @property({ attribute: 'receives-focus' })\n    public receivesFocus: 'true' | 'false' | 'auto' = 'auto';\n\n    @state()\n    private clickContent: HTMLElement[] = [];\n\n    private clickPlacement?: Placement;\n\n    @state()\n    private longpressContent: HTMLElement[] = [];\n\n    private longpressPlacement?: Placement;\n\n    @state()\n    private hoverContent: HTMLElement[] = [];\n\n    private hoverPlacement?: Placement;\n\n    @state()\n    private targetContent: HTMLElement[] = [];\n\n    @query('#click-overlay', true)\n    clickOverlayElement!: Overlay;\n\n    @query('#longpress-overlay', true)\n    longpressOverlayElement!: Overlay;\n\n    @query('#hover-overlay', true)\n    hoverOverlayElement!: Overlay;\n\n    private getAssignedElementsFromSlot(slot: HTMLSlotElement): HTMLElement[] {\n        return slot.assignedElements({ flatten: true }) as HTMLElement[];\n    }\n\n    private handleTriggerContent(\n        event: Event & { target: HTMLSlotElement }\n    ): void {\n        this.targetContent = this.getAssignedElementsFromSlot(event.target);\n    }\n\n    private handleSlotContent(\n        event: Event & { target: HTMLSlotElement }\n    ): void {\n        switch (event.target.name) {\n            case 'click-content':\n                this.clickContent = this.getAssignedElementsFromSlot(\n                    event.target\n                );\n                break;\n            case 'longpress-content':\n                this.longpressContent = this.getAssignedElementsFromSlot(\n                    event.target\n                );\n                break;\n            case 'hover-content':\n                this.hoverContent = this.getAssignedElementsFromSlot(\n                    event.target\n                );\n                break;\n        }\n    }\n\n    private handleBeforetoggle(event: BeforetoggleOpenEvent): void {\n        const { target } = event;\n        let type: OverlayContentTypes;\n        if (target === this.clickOverlayElement) {\n            type = 'click';\n        } else if (target === this.longpressOverlayElement) {\n            type = 'longpress';\n        } else if (target === this.hoverOverlayElement) {\n            type = 'hover';\n            /* c8 ignore next 3 */\n        } else {\n            return;\n        }\n        if (event.newState === 'open') {\n            this.open = type;\n        } else if (this.open === type) {\n            this.open = undefined;\n        }\n    }\n\n    protected override update(changes: PropertyValues): void {\n        if (changes.has('clickContent')) {\n            this.clickPlacement =\n                ((this.clickContent[0]?.getAttribute('placement') ||\n                    this.clickContent[0]?.getAttribute(\n                        'direction'\n                    )) as Placement) || undefined;\n        }\n        if (changes.has('hoverContent')) {\n            this.hoverPlacement =\n                ((this.hoverContent[0]?.getAttribute('placement') ||\n                    this.hoverContent[0]?.getAttribute(\n                        'direction'\n                    )) as Placement) || undefined;\n        }\n        if (changes.has('longpressContent')) {\n            this.longpressPlacement =\n                ((this.longpressContent[0]?.getAttribute('placement') ||\n                    this.longpressContent[0]?.getAttribute(\n                        'direction'\n                    )) as Placement) || undefined;\n        }\n        super.update(changes);\n    }\n\n    protected renderSlot(name: string): TemplateResult {\n        return html`\n            <slot name=${name} @slotchange=${this.handleSlotContent}></slot>\n        `;\n    }\n\n    protected renderClickOverlay(): TemplateResult {\n        const slot = this.renderSlot('click-content');\n        const clickOverlay = html`\n            <sp-overlay\n                id=\"click-overlay\"\n                ?disabled=${this.disabled || !this.clickContent.length}\n                ?open=${this.open === 'click' && !!this.clickContent.length}\n                .offset=${this.offset}\n                .placement=${this.clickPlacement || this.placement}\n                .triggerElement=${this.targetContent[0]}\n                .triggerInteraction=${'click'}\n                .type=${this.type !== 'modal' ? 'auto' : 'modal'}\n                @beforetoggle=${this.handleBeforetoggle}\n                .receivesFocus=${this.receivesFocus}\n            >\n                ${slot}\n            </sp-overlay>\n        `;\n\n        // If click interactions are explicitly enabled by customers, always return the overlay\n        if (this.triggeredBy?.includes('click')) {\n            return clickOverlay;\n        }\n\n        if (!this.clickContent.length) {\n            return slot;\n        } else {\n            return clickOverlay;\n        }\n    }\n\n    protected renderHoverOverlay(): TemplateResult {\n        const slot = this.renderSlot('hover-content');\n        const hoverOverlay = html`\n            <sp-overlay\n                id=\"hover-overlay\"\n                ?open=${this.open === 'hover' && !!this.hoverContent.length}\n                ?disabled=${this.disabled ||\n                !this.hoverContent.length ||\n                (!!this.open && this.open !== 'hover')}\n                .offset=${this.offset}\n                .placement=${this.hoverPlacement || this.placement}\n                .triggerElement=${this.targetContent[0]}\n                .triggerInteraction=${'hover'}\n                .type=${'hint'}\n                @beforetoggle=${this.handleBeforetoggle}\n                .receivesFocus=${this.receivesFocus}\n            >\n                ${slot}\n            </sp-overlay>\n        `;\n\n        // If hover interactions are explicitly enabled by customers, always return the overlay\n        if (this.triggeredBy?.includes('hover')) {\n            return hoverOverlay;\n        }\n\n        if (!this.hoverContent.length) {\n            return slot;\n        } else {\n            return hoverOverlay;\n        }\n    }\n\n    protected renderLongpressOverlay(): TemplateResult {\n        const slot = this.renderSlot('longpress-content');\n        const longpressOverlay = html`\n            <sp-overlay\n                id=\"longpress-overlay\"\n                ?disabled=${this.disabled || !this.longpressContent.length}\n                ?open=${this.open === 'longpress' &&\n                !!this.longpressContent.length}\n                .offset=${this.offset}\n                .placement=${this.longpressPlacement || this.placement}\n                .triggerElement=${this.targetContent[0]}\n                .triggerInteraction=${'longpress'}\n                .type=${'auto'}\n                @beforetoggle=${this.handleBeforetoggle}\n                .receivesFocus=${this.receivesFocus}\n            >\n                ${slot}\n            </sp-overlay>\n            <slot name=\"longpress-describedby-descriptor\"></slot>\n        `;\n\n        // If click interactions are explicitly enabled by customers, always return the overlay\n        if (this.triggeredBy?.includes('longpress')) {\n            return longpressOverlay;\n        }\n\n        if (!this.longpressContent.length) {\n            return slot;\n        } else {\n            return longpressOverlay;\n        }\n    }\n\n    protected override render(): TemplateResult {\n        // Keyboard event availability documented in README.md\n        return html`\n            <slot\n                id=\"trigger\"\n                name=\"trigger\"\n                @slotchange=${this.handleTriggerContent}\n            ></slot>\n            ${[\n                this.renderClickOverlay(),\n                this.renderHoverOverlay(),\n                this.renderLongpressOverlay(),\n            ]}\n        `;\n    }\n\n    protected override updated(changedProperties: PropertyValues): void {\n        super.updated(changedProperties);\n\n        if (window.__swc?.DEBUG && !this.triggeredBy) {\n            const issues = [\n                'You have not specified the `triggeredBy` property. For optimal performance, consider explicitly declaring which overlay types you plan to use.',\n                'Example: triggered-by=\"click hover\"',\n                'This helps avoid unnecessary DOM operations and potential race conditions.',\n            ];\n\n            window.__swc.warn(\n                this,\n                'Performance optimization available for <overlay-trigger>:',\n                'https://opensource.adobe.com/spectrum-web-components/components/overlay-trigger/#performance-optimization',\n                { issues }\n            );\n        }\n\n        if (this.disabled && changedProperties.has('disabled')) {\n            this.open = undefined;\n            return;\n        }\n    }\n\n    protected override async getUpdateComplete(): Promise<boolean> {\n        const complete = (await super.getUpdateComplete()) as boolean;\n        return complete;\n    }\n}\n"],
  "mappings": "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",
  "names": ["html", "SpectrumElement", "property", "query", "state", "overlayTriggerStyles", "slot", "event", "target", "type", "changes", "_a", "_b", "_c", "_d", "_e", "_f", "name", "clickOverlay", "hoverOverlay", "longpressOverlay", "changedProperties", "__decorateClass"]
}
