{
  "version": 3,
  "sources": ["overlay-timer.test.ts"],
  "sourcesContent": ["/*\nCopyright 2020 Adobe. All rights reserved.\nThis file is licensed to you under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License. You may obtain a copy\nof the License at http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software distributed under\nthe License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR REPRESENTATIONS\nOF ANY KIND, either express or implied. See the License for the specific language\ngoverning permissions and limitations under the License.\n*/\n\nimport { SinonFakeTimers, useFakeTimers } from 'sinon';\nimport { OverlayTimer } from '@spectrum-web-components/overlay/src/overlay-timer.js';\nimport { expect } from '@open-wc/testing';\n\ndescribe('Overlays timer', () => {\n    let clock: SinonFakeTimers;\n\n    beforeEach(() => {\n        clock = useFakeTimers();\n    });\n\n    afterEach(() => {\n        clock.restore();\n    });\n\n    it('should resolve after warmup', async () => {\n        const timer = new OverlayTimer({\n            warmUpDelay: 500,\n            coolDownDelay: 500,\n        });\n        const element = document.createElement('div');\n        const promise = timer.openTimer(element);\n        clock.next();\n        expect(clock.now).to.equal(500);\n        const cancelled = await promise;\n        expect(cancelled).to.be.false;\n    });\n\n    it('should resolve true when cancelled', async () => {\n        const timer = new OverlayTimer({\n            warmUpDelay: 500,\n            coolDownDelay: 500,\n        });\n        const element = document.createElement('div');\n        const promise = timer.openTimer(element);\n        clock.tick(10);\n        timer.close(element);\n        clock.next();\n        const cancelled = await promise;\n        expect(cancelled).to.be.true;\n    });\n\n    it('should resolve cancelled when opening new overlay', async () => {\n        const timer = new OverlayTimer({\n            warmUpDelay: 500,\n            coolDownDelay: 500,\n        });\n        const element1 = document.createElement('div');\n        const element2 = document.createElement('div');\n        const promise1 = timer.openTimer(element1);\n        clock.tick(10);\n        const promise2 = timer.openTimer(element2);\n        clock.tick(10);\n        let cancelled = await promise1;\n        expect(cancelled).to.be.true;\n        clock.next();\n        cancelled = await promise2;\n        expect(cancelled).to.be.false;\n        expect(clock.now).to.equal(510);\n    });\n\n    it('should cooldown after closing overlay', async () => {\n        const timer = new OverlayTimer({\n            warmUpDelay: 500,\n            coolDownDelay: 500,\n        });\n        const element = document.createElement('div');\n        let promise = timer.openTimer(element);\n        clock.next();\n        timer.close(element);\n        clock.next();\n        expect(clock.now).to.equal(1000);\n        promise = timer.openTimer(element);\n        clock.next();\n        const cancelled = await promise;\n        expect(cancelled).to.be.false;\n        expect(clock.now).to.equal(1500);\n    });\n\n    it('should open overlay quickly when hot', async () => {\n        const timer = new OverlayTimer({\n            warmUpDelay: 500,\n            coolDownDelay: 500,\n        });\n        const element = document.createElement('div');\n        let promise = timer.openTimer(element);\n        clock.next();\n        timer.close(element);\n        clock.tick(1);\n        promise = timer.openTimer(element);\n        clock.next();\n        const cancelled = await promise;\n        expect(cancelled).to.be.false;\n        expect(clock.now).to.equal(501);\n    });\n\n    it('should cooldown after opening and closing overlay multiple times', async () => {\n        const timer = new OverlayTimer({\n            warmUpDelay: 500,\n            coolDownDelay: 500,\n        });\n        const element = document.createElement('div');\n        let promise = timer.openTimer(element);\n        clock.next();\n        expect(clock.now).to.equal(500);\n        timer.close(element);\n        clock.tick(1);\n\n        for (let i = 0; i < 10; i++) {\n            const element = document.createElement('div');\n            promise = timer.openTimer(element);\n            clock.next();\n            const cancelled = await promise;\n            expect(cancelled).to.be.false;\n            timer.close(element);\n            clock.tick(1);\n        }\n\n        // Wait for cooldown\n        clock.next();\n        expect(clock.now).to.equal(1010);\n        promise = timer.openTimer(element);\n        clock.next();\n        const cancelled = await promise;\n        expect(cancelled).to.be.false;\n        expect(clock.now).to.equal(1510);\n    });\n});\n"],
  "mappings": "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",
  "names": ["element", "cancelled"]
}
