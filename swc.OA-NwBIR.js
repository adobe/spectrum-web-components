import{c as e}from"./swc.B6Ji04pc.js";import{r as t}from"./swc.x86Wm3h_.js";import{n as s}from"./swc.CeWRcydc.js";import{i,a as o}from"./swc.Ds_ROb9a.js";var r,n=((r=n||{}).click="click",r.hover="hover",r.longpress="longpress",r);const a=Symbol("lastInteractionType");class l{constructor(e,{overlay:t,isPersistent:s,handleOverlayReady:i}){this.target=e,this.isLazilyOpen=!1,this.isPersistent=!1,this.isPersistent=!!s,this.handleOverlayReady=i,this.isPersistent&&this.init(),this.overlay=t}get activelyOpening(){return!1}get open(){var e,t;return null!=(t=null==(e=this.overlay)?void 0:e.open)?t:this.isLazilyOpen}set open(e){if(e!==this.open){if(this.isLazilyOpen=e,this.overlay)return this.overlay.open=e,void(this.target[a]=this.type);e&&(customElements.whenDefined("sp-overlay").then(async()=>{const{Overlay:e}=await import("./swc.2jb2TuJz.js");this.overlay=new e,this.overlay.open=!0,this.target[a]=this.type}),import("./swc.Dj6892mD.js"))}}get overlay(){return this._overlay}set overlay(e){var t;e&&this._overlay!==e&&(this._overlay&&this._overlay.removeController(this),this._overlay=e,e.addController(this),this.initOverlay(),this.prepareDescription(this.target),null==(t=this.handleOverlayReady)||t.call(this,e))}clearOverlay(){this._overlay&&this._overlay.removeController(this),this._overlay=void 0}prepareDescription(e){}releaseDescription(){}shouldCompleteOpen(){}init(){}initOverlay(){}abort(){var e;this.releaseDescription(),null==(e=this.abortController)||e.abort()}hostConnected(){this.init()}hostDisconnected(){this.isPersistent||this.abort()}}const h={touch:"Double tap and long press for additional options",keyboard:"Press Space or Alt+Down Arrow for additional options",mouse:"Click and hold for additional options"};const d={click:class extends l{constructor(){super(...arguments),this.type=n.click,this.preventNextToggle=!1}handleClick(){this.preventNextToggle||(this.open=!this.open),this.preventNextToggle=!1}handlePointerdown(){this.preventNextToggle=this.open}init(){var e;null==(e=this.abortController)||e.abort(),this.abortController=new AbortController;const{signal:t}=this.abortController;this.target.addEventListener("click",()=>this.handleClick(),{signal:t}),this.target.addEventListener("pointerdown",()=>this.handlePointerdown(),{signal:t})}},longpress:class extends l{constructor(){super(...arguments),this.type=n.longpress,this.longpressState=null,this.releaseDescription=s,this.handlePointerup=()=>{var e;clearTimeout(this.timeout),this.target&&(this.longpressState="opening"===(null==(e=this.overlay)?void 0:e.state)?"pressed":null,document.removeEventListener("pointerup",this.handlePointerup),document.removeEventListener("pointercancel",this.handlePointerup))}}get activelyOpening(){return"opening"===this.longpressState||"pressed"===this.longpressState}handleLongpress(){this.open=!0,this.longpressState="potential"===this.longpressState?"opening":"pressed"}handlePointerdown(e){!this.target||0!==e.button||(this.longpressState="potential",document.addEventListener("pointerup",this.handlePointerup),document.addEventListener("pointercancel",this.handlePointerup),"holdAffordance"in this.target)||(this.timeout=setTimeout(()=>{this.target&&this.target.dispatchEvent(new CustomEvent("longpress",{bubbles:!0,composed:!0,detail:{source:"pointer"}}))},300))}handleKeydown(e){const{code:t,altKey:s}=e;s&&"ArrowDown"===t&&e.stopImmediatePropagation()}handleKeyup(e){const{code:t,altKey:s}=e;if("Space"===t||s&&"ArrowDown"===t){if(!this.target)return;e.stopPropagation(),this.target.dispatchEvent(new CustomEvent("longpress",{bubbles:!0,composed:!0,detail:{source:"keyboard"}})),setTimeout(()=>{this.longpressState=null})}}prepareDescription(r){if(this.releaseDescription!==s||!this.overlay||!this.overlay.elements.length)return;const n=document.createElement("div");n.id=`longpress-describedby-descriptor-${t()}`;const a=i()||o()?"touch":"keyboard";n.textContent=h[a],n.slot="longpress-describedby-descriptor";const l=r.getRootNode();l===this.overlay.getRootNode()?this.overlay.append(n):(n.hidden=!("host"in l),r.insertAdjacentElement("afterend",n));const d=e(r,"aria-describedby",[n.id]);this.releaseDescription=()=>{d(),n.remove(),this.releaseDescription=s}}shouldCompleteOpen(){this.longpressState="pressed"===this.longpressState?null:this.longpressState}init(){var e;null==(e=this.abortController)||e.abort(),this.abortController=new AbortController;const{signal:t}=this.abortController;this.target.addEventListener("longpress",()=>this.handleLongpress(),{signal:t}),this.target.addEventListener("pointerdown",e=>this.handlePointerdown(e),{signal:t}),this.prepareDescription(this.target),!this.target.holdAffordance&&(this.target.addEventListener("keydown",e=>this.handleKeydown(e),{signal:t}),this.target.addEventListener("keyup",e=>this.handleKeyup(e),{signal:t}))}},hover:class extends l{constructor(){super(...arguments),this.type=n.hover,this.elementIds=[],this.targetFocused=!1,this.hovering=!1,this.overlayFocused=!1}handleKeyup(e){"Tab"===e.code?this.open=!0:"Escape"===e.code&&this.open&&(e.preventDefault(),e.stopPropagation(),this.open=!1,this.target&&this.target.focus())}handleTargetFocusin(){this.target.matches(":focus-visible")&&this.target[a]!==n.click&&(this.open=!0,this.targetFocused=!0)}handleTargetFocusout(){this.targetFocused=!1,!this.hovering&&this.doFocusleave()}clearCloseTimeout(){this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=void 0)}handleTargetPointerenter(){var e;this.clearCloseTimeout(),(null==(e=this.overlay)||!e.disabled)&&(this.open=!0,this.hovering=!0)}handleTargetPointerleave(){this.doPointerleave()}handleHostPointerenter(){this.clearCloseTimeout()}handleHostPointerleave(){this.doPointerleave()}handleOverlayFocusin(){this.overlayFocused=!0,this.clearCloseTimeout()}handleOverlayFocusout(){this.overlayFocused=!1,!this.hovering&&(this.targetFocused&&this.target.matches(":focus-visible")||this.doFocusleave())}prepareDescription(){if(!this.overlay||!this.overlay.elements.length)return;const e=this.target.getRootNode(),t=this.overlay.elements[0].getRootNode();e===this.overlay.getRootNode()?this.prepareOverlayRelativeDescription():e===t&&this.prepareContentRelativeDescription()}prepareOverlayRelativeDescription(){if(!this.overlay)return;const t=e(this.target,"aria-describedby",[this.overlay.id]);this.releaseDescription=()=>{t(),this.releaseDescription=s}}prepareContentRelativeDescription(){if(!this.overlay)return;const i=this.overlay,o=[],r=i.elements.map(e=>(o.push(e.id),e.id||(e.id=`${i.tagName.toLowerCase()}-helper-${t()}`),e.id));this.elementIds=o;const n=e(this.target,"aria-describedby",r);this.releaseDescription=()=>{n(),i.elements.map((e,t)=>{e.id=this.elementIds[t]}),this.releaseDescription=s}}scheduleClose(){this.hoverTimeout=setTimeout(()=>{this.open=!1},300)}doPointerleave(){this.hovering=!1;const e=this.target;this.targetFocused&&e.matches(":focus-visible")||this.overlayFocused||this.scheduleClose()}doFocusleave(){this.clearCloseTimeout(),!this.targetFocused&&!this.overlayFocused&&!this.hovering&&this.scheduleClose()}init(){var e;null==(e=this.abortController)||e.abort(),this.abortController=new AbortController;const{signal:t}=this.abortController;this.target.addEventListener("keyup",e=>this.handleKeyup(e),{signal:t}),this.target.addEventListener("focusin",()=>this.handleTargetFocusin(),{signal:t}),this.target.addEventListener("focusout",()=>this.handleTargetFocusout(),{signal:t}),this.target.addEventListener("pointerenter",()=>this.handleTargetPointerenter(),{signal:t}),this.target.addEventListener("pointerleave",()=>this.handleTargetPointerleave(),{signal:t}),this.overlay&&this.initOverlay()}initOverlay(){if(!this.abortController||!this.overlay)return;const{signal:e}=this.abortController;this.overlay.addEventListener("pointerenter",()=>this.handleHostPointerenter(),{signal:e}),this.overlay.addEventListener("pointerleave",()=>this.handleHostPointerleave(),{signal:e}),this.overlay.addEventListener("focusin",()=>this.handleOverlayFocusin(),{signal:e}),this.overlay.addEventListener("focusout",()=>this.handleOverlayFocusout(),{signal:e}),this.overlay.addEventListener("keyup",e=>this.handleKeyup(e),{signal:e})}}};export{n as I,h as L,d as s};
//# sourceMappingURL=swc.BrN86TuZ.js.map
